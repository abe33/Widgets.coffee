<!DOCTYPE html>  <html> <head>   <title>colorpicker.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="Cakefile.html">                 Cakefile.coffee               </a>                                           <a class="source" href="Nemfile.html">                 Nemfile.coffee               </a>                                           <a class="source" href="builder.html">                 builder.coffee               </a>                                           <a class="source" href="button.html">                 button.coffee               </a>                                           <a class="source" href="calendar.html">                 calendar.coffee               </a>                                           <a class="source" href="checkbox.html">                 checkbox.coffee               </a>                                           <a class="source" href="colorpicker.html">                 colorpicker.coffee               </a>                                           <a class="source" href="container.html">                 container.coffee               </a>                                           <a class="source" href="dates.html">                 dates.coffee               </a>                                           <a class="source" href="filepicker.html">                 filepicker.coffee               </a>                                           <a class="source" href="jquery.html">                 jquery.coffee               </a>                                           <a class="source" href="keys.html">                 keys.coffee               </a>                                           <a class="source" href="menus.html">                 menus.coffee               </a>                                           <a class="source" href="mixins.html">                 mixins.coffee               </a>                                           <a class="source" href="module.html">                 module.coffee               </a>                                           <a class="source" href="nem.html">                 nem.coffee               </a>                                           <a class="source" href="numeric-widget.html">                 numeric-widget.coffee               </a>                                           <a class="source" href="radio.html">                 radio.coffee               </a>                                           <a class="source" href="radiogroup.html">                 radiogroup.coffee               </a>                                           <a class="source" href="selects.html">                 selects.coffee               </a>                                           <a class="source" href="signals.html">                 signals.coffee               </a>                                           <a class="source" href="slider.html">                 slider.coffee               </a>                                           <a class="source" href="std.html">                 std.coffee               </a>                                           <a class="source" href="stepper.html">                 stepper.coffee               </a>                                           <a class="source" href="textarea.html">                 textarea.coffee               </a>                                           <a class="source" href="textinput.html">                 textinput.coffee               </a>                                           <a class="source" href="widgets.html">                 widgets.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               colorpicker.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><link rel='stylesheet' href='../css/styles.css' media='screen'>
<link rel='stylesheet' href='../css/widgets.css' media='screen'></p>

<script type='text/javascript' src='../depends/jquery-1.6.1.min.js'></script>

<script type='text/javascript' src='../depends/jquery.mousewheel.js'></script>

<script type='text/javascript' src='../lib/widgets.js'></script>

<script type='text/javascript' src='../lib/builder.js'></script>

<h3>In this file</h3>

<p>The <code>ColorInput</code> widget relys on several functions and widgets
that are also declared in this file, you can find below
the list of classes that are defined:</p>

<ul>
<li><a href="#colorinput">ColorInput</a></li>
<li><a href="#gridpicker">SquarePicker</a></li>
<li><a href="#colorpicker">ColorPicker</a></li>
<li><a href="#AbstractMode">AbstractMode</a></li>
<li><a href="#HSV">HSVMode</a></li>
<li><a href="#SHV">SHVMode</a></li>
<li><a href="#VHS">VHSMode</a></li>
<li><a href="#RGB">RGBMode</a></li>
<li><a href="#GRB">GRBMode</a></li>
<li><a href="#BGR">BGRMode</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h3>Color Conversions</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Converts a color defined with its red, green and blue channels into
an hexadecimal string.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rgb2hex </span><span class="o">=</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nv">rnd </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span>
  <span class="nv">value </span><span class="o">=</span> <span class="p">((</span><span class="nx">rnd</span><span class="p">(</span><span class="nx">r</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">rnd</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="nx">rnd</span><span class="p">(</span><span class="nx">b</span><span class="p">)).</span><span class="nx">toString</span> <span class="mi">16</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The value is filled with <code>0</code> to match a length of 6.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">value </span><span class="o">=</span> <span class="s">&quot;0</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">while</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">6</span>

  <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Converts an hexadecimal string such as <code>#abcdef</code> into an array
with the red, green and blue channels values.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">hex2rgb </span><span class="o">=</span> <span class="p">(</span><span class="nx">hex</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nv">rgb </span><span class="o">=</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">substr</span> <span class="mi">1</span>
  <span class="nv">color </span><span class="o">=</span> <span class="nb">parseInt</span> <span class="nx">rgb</span><span class="p">,</span> <span class="mi">16</span>

  <span class="nv">r </span><span class="o">=</span> <span class="p">(</span><span class="nx">color</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
  <span class="nv">g </span><span class="o">=</span> <span class="p">(</span><span class="nx">color</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span>
  <span class="nv">b </span><span class="o">=</span> <span class="nx">color</span> <span class="o">&amp;</span> <span class="mh">0xff</span>

  <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Converts a color in the <code>rgb</code> color space in an
array with the color in the <code>hsv</code> color space.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">rgb2hsv </span><span class="o">=</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>

  <span class="nv">r </span><span class="o">=</span> <span class="nx">r</span> <span class="o">/</span> <span class="mi">255</span>
  <span class="nv">g </span><span class="o">=</span> <span class="nx">g</span> <span class="o">/</span> <span class="mi">255</span>
  <span class="nv">b </span><span class="o">=</span> <span class="nx">b</span> <span class="o">/</span> <span class="mi">255</span>
  <span class="nv">rnd </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span>

  <span class="nv">minVal </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
  <span class="nv">maxVal </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
  <span class="nv">delta </span><span class="o">=</span> <span class="nx">maxVal</span> <span class="o">-</span> <span class="nx">minVal</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Value is always the maximal component's value.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">v </span><span class="o">=</span> <span class="nx">maxVal</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>The color is a gray, there's no need to proceed further.
Both saturation and hue equals to <code>0</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">delta</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="nv">h </span><span class="o">=</span> <span class="mi">0</span>
    <span class="nv">s </span><span class="o">=</span> <span class="mi">0</span>
  <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>The lower the delta is in comparison with the value
the higher the saturation will be.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">s </span><span class="o">=</span> <span class="nx">delta</span> <span class="o">/</span> <span class="nx">v</span>
    <span class="nv">deltaR </span><span class="o">=</span> <span class="p">(((</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">delta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="nx">delta</span>
    <span class="nv">deltaG </span><span class="o">=</span> <span class="p">(((</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">g</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">delta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="nx">delta</span>
    <span class="nv">deltaB </span><span class="o">=</span> <span class="p">(((</span><span class="nx">v</span> <span class="o">-</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">delta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="nx">delta</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>In a range from <code>0</code> to <code>1</code>, full red is at <code>0</code> and <code>1</code>,
full green is at <code>1/3</code> and full blue at <code>2/3</code>.</p>

<p>From the point in the range corresponding to the dominant
component, the delta of the other channels are both added
in order to move the hue around this point.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">r</span> <span class="o">is</span> <span class="nx">v</span>      <span class="k">then</span> <span class="nv">h </span><span class="o">=</span> <span class="nx">deltaB</span> <span class="o">-</span> <span class="nx">deltaG</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nx">g</span> <span class="o">is</span> <span class="nx">v</span> <span class="k">then</span> <span class="nv">h </span><span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">deltaR</span> <span class="o">-</span> <span class="nx">deltaB</span>
    <span class="k">else</span> <span class="k">if</span> <span class="nv">b </span><span class="o">==</span> <span class="nx">v</span> <span class="k">then</span> <span class="nv">h </span><span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nx">deltaG</span> <span class="o">-</span> <span class="nx">deltaR</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Hue is then reduced to fit in the <code>0-1</code> range.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">h</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nx">h</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nx">h</span> <span class="o">-=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nx">h</span> <span class="o">&gt;</span> <span class="mi">1</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>And, finally, hue, saturation and value are normalized
to their corresponding range.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="p">[</span><span class="nx">h</span> <span class="o">*</span> <span class="mi">360</span><span class="p">,</span> <span class="nx">s</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="nx">v</span> <span class="o">*</span> <span class="mi">100</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Converts a color defined in the <code>hsv</code> color space into
an array containing the color in the <code>rgb</code> color space.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">hsv2rgb </span><span class="o">=</span> <span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Hue is reduced to the <code>0-6</code> range when both saturation
and value are reduced to the <code>0-1</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">h </span><span class="o">=</span> <span class="nx">h</span> <span class="o">/</span> <span class="mi">60</span>
  <span class="nv">s </span><span class="o">=</span> <span class="nx">s</span> <span class="o">/</span> <span class="mi">100</span>
  <span class="nv">v </span><span class="o">=</span> <span class="nx">v</span> <span class="o">/</span> <span class="mi">100</span>
  <span class="nv">rnd </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Short circuit when saturation is <code>0</code>, all other channels
will end up to <code>0</code> as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">s</span> <span class="o">is</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">rnd</span> <span class="nx">v</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">rnd</span> <span class="nx">v</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">rnd</span> <span class="nx">v</span> <span class="o">*</span> <span class="mi">255</span><span class="p">]</span>
  <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>By rounding the hue we obtain the dominant
color such as :</p>

<ul>
<li>0 = Red</li>
<li>1 = Yellow</li>
<li>2 = Green</li>
<li>3 = Cyan</li>
<li>4 = Blue</li>
<li>5 = Fuschia</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">dominant </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">h</span>

    <span class="nv">comp1 </span><span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span><span class="p">)</span>
    <span class="nv">comp2 </span><span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span> <span class="o">*</span> <span class="p">(</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">dominant</span><span class="p">))</span>
    <span class="nv">comp3 </span><span class="o">=</span> <span class="nx">v</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="nx">s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="nx">h</span> <span class="o">-</span> <span class="nx">dominant</span><span class="p">)))</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>According to the dominant color we affect
the values to each component.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">switch</span> <span class="nx">dominant</span>
      <span class="k">when</span> <span class="mi">0</span> <span class="k">then</span> <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">v</span><span class="p">,</span> <span class="nx">comp3</span><span class="p">,</span> <span class="nx">comp1</span><span class="p">]</span>
      <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">comp2</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">comp1</span><span class="p">]</span>
      <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">comp1</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">comp3</span><span class="p">]</span>
      <span class="k">when</span> <span class="mi">3</span> <span class="k">then</span> <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">comp1</span><span class="p">,</span> <span class="nx">comp2</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span>
      <span class="k">when</span> <span class="mi">4</span> <span class="k">then</span> <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">comp3</span><span class="p">,</span> <span class="nx">comp1</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span>
      <span class="k">else</span>        <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">v</span><span class="p">,</span> <span class="nx">comp1</span><span class="p">,</span> <span class="nx">comp2</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>And each component is normalized to fit in the
<code>0-255</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="p">[</span><span class="nx">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">,</span> <span class="nx">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Converts a color in a string into an object with
the three channels values as integer between 0 and 255.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">colorObjectFromValue </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hex2rgb</span> <span class="nx">value</span>

  <span class="py">red</span><span class="o">:</span><span class="nx">r</span><span class="p">,</span> <span class="py">green</span><span class="o">:</span><span class="nx">g</span><span class="p">,</span> <span class="py">blue</span><span class="o">:</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Converts an object with <code>red</code>, <code>green</code> and <code>blue</code> properties
to a string with the html representation of the color.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">colorObjectToValue </span><span class="o">=</span> <span class="p">(</span><span class="nx">rgb</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">rgb2hex</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">red</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">green</span><span class="p">,</span> <span class="nx">rgb</span><span class="p">.</span><span class="nx">blue</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Color Validations</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Validates that the passed-in string is a valid hexadecimal color code.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidValue </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nv">re </span><span class="o">=</span> <span class="sr">///</span> <span class="sro">^</span>       <span class="c1"># nothing allowed before</span>
    <span class="sr">\#</span>             <span class="c1"># starts with a diese</span>
    <span class="src">[0-9a-fA-F]</span><span class="sro">{</span><span class="sri">6</span><span class="sro">}</span> <span class="c1"># must have 6 chars in 0123456789abcdefABCDEF</span>
  <span class="sro">$</span> <span class="sr">///</span>            <span class="c1"># nothing allowed after</span>

  <span class="nx">re</span><span class="p">.</span><span class="nx">test</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Validates that the passed-in argument is a valid number.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidNumber </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">value</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Validates that the passed-in argument is a valid hue.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidHue </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">(</span><span class="nx">isValidNumber</span> <span class="nx">value</span><span class="p">)</span> <span class="o">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">value</span> <span class="o">&lt;=</span> <span class="mi">360</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Validates that the passed-in argument is a valid percentage.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidPercentage </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">(</span><span class="nx">isValidNumber</span> <span class="nx">value</span><span class="p">)</span> <span class="o">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">value</span> <span class="o">&lt;=</span> <span class="mi">100</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Validates that the passed-in argument is a valid channel value.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidChannel </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">(</span><span class="nx">isValidNumber</span> <span class="nx">value</span><span class="p">)</span> <span class="o">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nx">value</span> <span class="o">&lt;=</span> <span class="mi">255</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Validates that the passed-in color object is valid.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidColor </span><span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="nx">value</span><span class="o">?</span>                       <span class="o">and</span>
  <span class="p">(</span><span class="nx">isValidChannel</span> <span class="nx">value</span><span class="p">.</span><span class="nx">red</span><span class="p">)</span>   <span class="o">and</span>
  <span class="p">(</span><span class="nx">isValidChannel</span> <span class="nx">value</span><span class="p">.</span><span class="nx">green</span><span class="p">)</span> <span class="o">and</span>
  <span class="p">(</span><span class="nx">isValidChannel</span> <span class="nx">value</span><span class="p">.</span><span class="nx">blue</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Validates that the passed-in red green and blue channels form a valid color.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidRGB </span><span class="o">=</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">(</span><span class="nx">isValidChannel</span> <span class="nx">r</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">isValidChannel</span> <span class="nx">g</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">isValidChannel</span> <span class="nx">b</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Validates that the passed-in hue, saturation and value channels
form a valid color.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidHSV </span><span class="o">=</span> <span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>
  <span class="p">(</span><span class="nx">isValidHue</span> <span class="nx">h</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">isValidPercentage</span> <span class="nx">s</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="nx">isValidPercentage</span> <span class="nx">v</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p><a name ='colorinput'></a></p>

<h1>ColorInput</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">ColorInput</span> <span class="k">extends</span> <span class="nb">Widget</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Here some live instances of the <code>ColorInput</code> widget :</p>

<div id='colorinputs'></div>

<script type='text/javascript'>
  var config = ({
  container: "colorinputs",
  builder: {
    title: "ColorInputs",
    cls: this["ColorInput"],
    rows: 1,
    cols: 3,
    tableClass: "demo-table",
    cells: function(opts) {
      var colors, states;
      states = [null, "readonly", "disabled"];
      colors = ["#cbdc1b", "#66ff99", "#6699ff"];
      opts.widget.set("value", colors[opts.col]);
      if (states[opts.col] != null) return opts.widget.set(states[opts.col], true);
    },
    columnHeaders: function(opts) {
      return ["Normal", "Readonly", "Disabled"][opts.col];
    }
  }
});

  var builder = new TableBuilder(config.builder);
  $("#colorinputs").append(builder.build());
</script>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">constructor</span><span class="o">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h3>ColorInput Signals</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>The <code>dialogRequested</code> signal is dispatched when the widget
is activated through a click or a keyboard input.</p>

<p>Its purpose is to allow an external widget to handle the
color choice itself.</p>

<p><em>Callback arguments</em></p>

<ul>
<li><code>widget</code>    : The colorinput that request a dialog.</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@dialogRequested</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Signal</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>The initial value is retreived from the target if defined.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">value </span><span class="o">=</span> <span class="py">@valueFromAttribute</span> <span class="s">&quot;value&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>A <code>ColorInput</code> has always a valid color as value,
the default is <code>#000000</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">value </span><span class="o">=</span> <span class="s">&quot;#000000&quot;</span> <span class="k">unless</span> <span class="nx">isValidValue</span> <span class="nx">value</span>

    <span class="py">@</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The color object is then created with the widget's value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@color</span> <span class="o">=</span> <span class="nx">colorObjectFromValue</span> <span class="nx">value</span>

    <span class="py">@dialogRequested</span><span class="p">.</span><span class="nx">add</span> <span class="nb">ColorInput</span><span class="p">.</span><span class="nx">defaultListener</span><span class="p">.</span><span class="nx">dialogRequested</span><span class="p">,</span>
                         <span class="nb">ColorInput</span><span class="p">.</span><span class="nx">defaultListener</span>

    <span class="py">@updateDummy</span> <span class="nx">value</span>

    <span class="py">@hideTarget</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <h3>Keyboard Controls</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Both the <code>Enter</code> and <code>Space</code> keys can be used instead
of the click to display the dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@registerKeyDownCommand</span> <span class="nx">keystroke</span><span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">space</span><span class="p">),</span> <span class="py">@click</span>
    <span class="py">@registerKeyDownCommand</span> <span class="nx">keystroke</span><span class="p">(</span><span class="nx">keys</span><span class="p">.</span><span class="nx">enter</span><span class="p">),</span> <span class="py">@click</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <h3>Target Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Color inputs only allow input with a <code>color</code> type
as target.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">checkTarget</span><span class="o">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@isInputWithType</span> <span class="nx">target</span><span class="p">,</span> <span class="s">&quot;color&quot;</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;ColorInput&#39;s target should be a color input&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <h3>Dummy Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>The <code>ColorInput</code> dummy contains an additional <code>span</code> used
to display the current color of this widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">createDummy</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">$</span> <span class="s">&quot;&lt;span class=&#39;colorinput&#39;&gt;</span>
<span class="s">         &lt;span class=&#39;color&#39;&gt;&lt;/span&gt;</span>
<span class="s">       &lt;/span&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>The <code>ColorInput</code> widget automatically update the color preview
through the <code>style</code> attribute of the dummy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">updateDummy</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="py">@hasDummy</span>
      <span class="nv">colorPreview </span><span class="o">=</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">children</span> <span class="s">&quot;.color&quot;</span>
      <span class="p">{</span><span class="py">red</span><span class="o">:</span><span class="nx">r</span><span class="p">,</span> <span class="py">green</span><span class="o">:</span><span class="nx">g</span><span class="p">,</span> <span class="py">blue</span><span class="o">:</span> <span class="nx">b</span><span class="p">}</span> <span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;color&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>The color channel average value is used to define
whether the text should be black or white.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">[</span><span class="nx">h</span><span class="p">,</span><span class="nx">s</span><span class="p">,</span><span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgb2hsv</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
      <span class="nv">textColor </span><span class="o">=</span> <span class="k">if</span> <span class="nx">v</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="k">then</span> <span class="s">&quot;#000000&quot;</span> <span class="k">else</span> <span class="s">&quot;#ffffff&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>The html code of the color is displayed
in the <code>color</code> child.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">colorPreview</span><span class="p">.</span><span class="nx">text</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>That same child background color is then changed according
to the widget's current color.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">colorPreview</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;background: </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">; color: </span><span class="si">#{</span><span class="nx">textColor</span><span class="si">}</span><span class="s">;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h3>Properties Accessors</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>The <code>color</code> setter takes an object such as :</p>

<pre><code>red: 145
green: 254
blue: 12
</code></pre>

<p>And modify the current widget's value with the values it contains.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_color</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>If the passed-in object isn't valid the value
is keep unchanged.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="py">@get</span> <span class="s">&quot;color&quot;</span> <span class="k">unless</span> <span class="nx">isValidColor</span> <span class="nx">value</span>

    <span class="nv">rgb </span><span class="o">=</span> <span class="nx">colorObjectToValue</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>The value is then changed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="s">&quot;#</span><span class="si">#{</span><span class="nx">rgb</span><span class="si">}</span><span class="s">&quot;</span>
    <span class="py">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Sets the value for this widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_value</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>If the passed-in value isn't a valid color the
widget's value is keep unchanged</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">return</span> <span class="py">@get</span> <span class="s">&quot;value&quot;</span> <span class="k">unless</span> <span class="nx">isValidValue</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>The <code>color</code> object for this widget is updated according
to the new widget's value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@</span><span class="p">[</span><span class="s">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">colorObjectFromValue</span> <span class="nx">value</span>
    <span class="py">@updateDummy</span> <span class="nx">value</span>

    <span class="k">super</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <h3>Events Handling</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Clicking on a color picker dispatch a dialog request signal.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">click</span><span class="o">:</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@dialogRequested</span><span class="p">.</span><span class="nx">dispatch</span> <span class="k">this</span> <span class="k">unless</span> <span class="py">@cantInteract</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p><a name ="gridpicker"></a></p>

<h1>SquarePicker</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>The <code>SquarePicker</code> widget is used in the <code>ColorPicker</code>.
It allow to manipulate value by dragging a cursor over a surface.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">SquarePicker</span> <span class="k">extends</span> <span class="nb">Widget</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Here some live instances :</p>

<div id='squarepickers'></div>

<script type='text/javascript'>
  var config = ({
  container: "squarepickers",
  builder: {
    title: "SquarePickers",
    cls: this["SquarePicker"],
    rows: 1,
    cols: 4,
    tableClass: "demo-table",
    cells: function(opts) {
      var states, styles;
      states = [null, null, "readonly", "disabled"];
      styles = ["", "vertical", "", "vertical"];
      if (opts.col % 2 === 1) {
        opts.widget.lockX();
        opts.td.css("width", "auto");
      }
      opts.widget.addClasses(styles[opts.col]);
      opts.widget.set("value", [Math.random(), Math.random()]);
      if (states[opts.col] != null) return opts.widget.set(states[opts.col], true);
    },
    columnHeaders: function(opts) {
      return ["Normal", "", "Vertical", ""][opts.col];
    }
  }
});

  var builder = new TableBuilder(config.builder);
  $("#squarepickers").append(builder.build());
</script>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">constructor</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span>

    <span class="py">@rangeX</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="py">@rangeY</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="py">@dragging</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="py">@xLocked</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="py">@yLocked</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <h3>Axis Locks</h3>

<p>The widget's cursor can be locked either on the X axis
or on the Y axis.</p>

<p>The locks prevent any modification to the value of the
locked axis, either by an interaction or by the <code>value</code>
setter.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">lockX</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@xLocked</span> <span class="o">=</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Locks can be unlocked as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">unlockX</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@xLocked</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">lockY</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@yLocked</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="py">unlockY</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@yLocked</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <h3>Dummy Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>The cursor for the widget is a <code>span</code> indide
the dummy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">createDummy</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nx">$</span> <span class="s">&quot;&lt;span class=&#39;gridpicker&#39;&gt;</span>
<span class="s">         &lt;span class=&#39;cursor&#39;&gt;&lt;/span&gt;</span>
<span class="s">       &lt;/span&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Updates the widget according to the passerd-in
<code>x</code> and <code>y</code> values.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">updateDummy</span><span class="o">:</span> <span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">cursor </span><span class="o">=</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&quot;.cursor&quot;</span><span class="p">)</span>

    <span class="nv">w </span><span class="o">=</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">h </span><span class="o">=</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>

    <span class="nv">cw </span><span class="o">=</span> <span class="nx">cursor</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">ch </span><span class="o">=</span> <span class="nx">cursor</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span>

    <span class="p">[</span><span class="nx">xmin</span><span class="p">,</span> <span class="nx">xmax</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;rangeX&quot;</span>
    <span class="p">[</span><span class="nx">ymin</span><span class="p">,</span> <span class="nx">ymax</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;rangeY&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>The values are normalized in the range 0-1</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">rx </span><span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">-</span> <span class="nx">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">xmax</span> <span class="o">-</span> <span class="nx">xmin</span><span class="p">)</span>
    <span class="nv">ry </span><span class="o">=</span> <span class="p">(</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nx">ymax</span> <span class="o">-</span> <span class="nx">ymin</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>The cursor is then centered on the position
within the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">left </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">rx</span> <span class="o">*</span> <span class="nx">w</span> <span class="o">-</span> <span class="p">(</span><span class="nx">cw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nv">top </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span> <span class="nx">ry</span> <span class="o">*</span> <span class="nx">h</span> <span class="o">-</span> <span class="p">(</span><span class="nx">ch</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nx">cursor</span><span class="p">.</span><span class="nx">css</span> <span class="s">&quot;left&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">left</span><span class="si">}</span><span class="s">px&quot;</span>
    <span class="nx">cursor</span><span class="p">.</span><span class="nx">css</span> <span class="s">&quot;top&quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">top</span><span class="si">}</span><span class="s">px&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <h3>Properties Accessors</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Sets the value of the horizontal range.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_rangeX</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@isValidRange</span> <span class="nx">value</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span>
    <span class="py">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Sets the value of the vertical range.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_rangeY</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@isValidRange</span> <span class="nx">value</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span>
    <span class="py">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Sets the value for this widget.
The value is an array containing the two values
the <code>x</code> and <code>y</code> axis respectively.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_value</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Invalid values, or values outside of the ranges
are ignored.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="o">and</span>
         <span class="k">typeof</span> <span class="nx">value</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span> <span class="o">and</span>
         <span class="nx">value</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">2</span> <span class="o">and</span>
         <span class="py">@isValid</span><span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;rangeX&quot;</span><span class="p">)</span> <span class="o">and</span>
         <span class="py">@isValid</span><span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;rangeY&quot;</span><span class="p">)</span>
      <span class="k">return</span> <span class="py">@get</span> <span class="s">&quot;value&quot;</span>

    <span class="nv">v </span><span class="o">=</span> <span class="py">@get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)</span>
    <span class="p">[</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Prevents values to be modified when locks are active.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x </span><span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="py">@xLocked</span>
    <span class="nv">y </span><span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="py">@yLocked</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Updates the dummy with the final values.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@updateDummy</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span>

    <span class="k">super</span> <span class="nx">property</span><span class="p">,</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>The <code>handlePropertyChange</code> is overriden to catch
changes done on <code>rangeX</code> and <code>rangeY</code> in order
to adjust the value if needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">handlePropertyChange</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Match that the call concern either <code>rangeX</code> or <code>rangeY</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">property</span> <span class="k">in</span> <span class="p">[</span><span class="s">&quot;rangeX&quot;</span><span class="p">,</span> <span class="s">&quot;rangeY&quot;</span><span class="p">]</span>
      <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;value&quot;</span>
      <span class="p">[</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="nx">property</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Collides the corresponding axis agaisnt the range.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">switch</span> <span class="nx">property</span>
        <span class="k">when</span> <span class="s">&quot;rangeX&quot;</span>
          <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">max</span>      <span class="k">then</span> <span class="nv">x </span><span class="o">=</span> <span class="nx">max</span>
          <span class="k">else</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">min</span> <span class="k">then</span> <span class="nv">x </span><span class="o">=</span> <span class="nx">min</span>
        <span class="k">when</span> <span class="s">&quot;rangeY&quot;</span>
          <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">max</span>      <span class="k">then</span> <span class="nv">y </span><span class="o">=</span> <span class="nx">max</span>
          <span class="k">else</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">min</span> <span class="k">then</span> <span class="nv">y </span><span class="o">=</span> <span class="nx">min</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Updates the value.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <h3>Validations</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Validates that the passed-in <code>value</code> match the passed-in <code>range</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">isValid</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">range</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="nx">range</span>
    <span class="nx">value</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">and</span> <span class="nx">min</span> <span class="o">&lt;=</span> <span class="nx">value</span> <span class="o">&lt;=</span> <span class="nx">max</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Validates that the passed-in <code>range</code> is a valid range.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">isValidRange</span><span class="o">:</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>A range takes the form of an array with two values,
the <code>min</code> and the <code>max</code> bounds.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="p">[</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>A range is valid when its two bounds are numbers and
that the <code>min</code> value is lower than the <code>max</code> value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">min</span><span class="o">?</span> <span class="o">and</span> <span class="nx">max</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">min</span><span class="p">)</span> <span class="o">and</span> <span class="o">not</span> <span class="nb">isNaN</span><span class="p">(</span><span class="nx">max</span><span class="p">)</span> <span class="o">and</span> <span class="nx">min</span> <span class="o">&lt;</span> <span class="nx">max</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <h3>Cursor Dragging</h3>

<p>Pressing the mouse over the widget starts a drag gesture.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">mousedown</span><span class="o">:</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@cantInteract</span><span class="p">()</span>
      <span class="py">@dragging</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="py">@drag</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Mouse release outside of the widget stop the drag as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="py">@documentMouseUpDelegate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="py">@mouseup</span> <span class="nx">e</span>

      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="py">@documentMouseMoveDelegate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="py">@mousemove</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>The widget takes focus as soon as the drag starts.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@grabFocus</span><span class="p">()</span> <span class="k">unless</span> <span class="py">@get</span> <span class="s">&quot;disabled&quot;</span>
    <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Perform the drag during the mouse moves.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">mousemove</span><span class="o">:</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@drag</span> <span class="nx">e</span> <span class="k">if</span> <span class="py">@dragging</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Releaseing the mouse stops the drag gesture.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">mouseup</span><span class="o">:</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="py">@dragging</span>
      <span class="py">@drag</span> <span class="nx">e</span>
      <span class="py">@dragging</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="py">@documentMouseUpDelegate</span>
      <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="py">@documentMouseMoveDelegate</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Realizes the drag gesture.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">drag</span><span class="o">:</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">w </span><span class="o">=</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">width</span><span class="p">()</span>
    <span class="nv">h </span><span class="o">=</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">height</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>The mouse position relatively to the widget is calculated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">x </span><span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">left</span>
    <span class="nv">y </span><span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="py">@dummy</span><span class="p">.</span><span class="nx">offset</span><span class="p">().</span><span class="nx">top</span>

    <span class="nv">x </span><span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">x </span><span class="o">=</span> <span class="nx">w</span> <span class="k">if</span> <span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">w</span>
    <span class="nv">y </span><span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="nv">y </span><span class="o">=</span> <span class="nx">h</span> <span class="k">if</span> <span class="nx">y</span> <span class="o">&gt;</span> <span class="nx">h</span>

    <span class="p">[</span><span class="nx">xmin</span><span class="p">,</span> <span class="nx">xmax</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;rangeX&quot;</span>
    <span class="p">[</span><span class="nx">ymin</span><span class="p">,</span> <span class="nx">ymax</span><span class="p">]</span> <span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;rangeY&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>And mapped according to the two ranges of the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">vx </span><span class="o">=</span> <span class="nx">xmin</span> <span class="o">+</span> <span class="p">(</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">w</span><span class="p">)</span> <span class="o">*</span> <span class="nx">xmax</span>
    <span class="nv">vy </span><span class="o">=</span> <span class="nx">ymin</span> <span class="o">+</span> <span class="p">(</span><span class="nx">y</span> <span class="o">/</span> <span class="nx">h</span><span class="p">)</span> <span class="o">*</span> <span class="nx">ymax</span>

    <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">vx</span><span class="p">,</span> <span class="nx">vy</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p><a name ="colorpicker"></a></p>

<h1>ColorPicker</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>The <code>ColorPicker</code> class handle the manipulation
of the color for a given <code>ColorInput</code> object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">ColorPicker</span> <span class="k">extends</span> <span class="nb">Widget</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Here a live instance of the <code>ColorPicker</code> widget :</p>

<div id='colorpicker'></div>

<script type='text/javascript'>
  var config = ({
  container: "colorpicker",
  builder: {
    title: "ColorPicker",
    cls: this["ColorPicker"],
    rows: 1,
    cols: 1,
    tableClass: "demo-table",
    cells: function(opts) {
      opts.td.css("width", "auto");
      opts.widget.set("value", "#abcdef");
      return opts.widget.addClasses("dummy");
    }
  }
});

  var builder = new TableBuilder(config.builder);
  $("#colorpicker").append(builder.build());
</script>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">@mixins</span> <span class="nb">HasChildren</span><span class="p">,</span> <span class="nb">DropDownPopup</span>

  <span class="py">constructor</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="k">super</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>The color is stored internally as an object that
always contains both the <code>rgb</code> channels and the
<code>hsv</code> channels.</p>

<p>All the computations are done with the datas stored
in this object. Ultimately the changes made
by a user interaction are affected to the widget's
value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@model</span> <span class="o">=</span> <span class="py">r</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="py">g</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="py">b</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="py">h</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="py">s</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="py">v</span><span class="o">:</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>When interactions are done on the children of the
<code>ColorPicker</code> the model is updated and each
child receive its new value.</p>

<p>This property prevent
chilren's signals to produce an infinite loop when
updated by the dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@inputValueSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>The <code>ColorPicker</code> supports 6 modes for the
grid inputs configuration.</p>

<p>Those modes are <a href="#HSV">HSV</a>, <a href="#SHV">SHV</a>, <a href="#VHS">VHS</a>,
<a href="#RGB">RGB</a>, <a href="#GRB">GRB</a>, <a href="#BGR">BGR</a>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@mode</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="py">@editModes</span> <span class="o">=</span> <span class="p">[</span>
      <span class="k">new</span> <span class="nb">RGBMode</span>
      <span class="k">new</span> <span class="nb">GRBMode</span>
      <span class="k">new</span> <span class="nb">BGRMode</span>
      <span class="k">new</span> <span class="nb">HSVMode</span>
      <span class="k">new</span> <span class="nb">SHVMode</span>
      <span class="k">new</span> <span class="nb">VHSMode</span>
    <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>Modes are selectabled through radio button and a radio group
to rules them all.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@modesGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RadioGroup</span>
    <span class="py">@modesGroup</span><span class="p">.</span><span class="nx">selectionChanged</span><span class="p">.</span><span class="nx">add</span> <span class="py">@modeChanged</span><span class="p">,</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>Creates all the children widgets.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@createDummyChildren</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>The default mode is the <a href="#HSV">HSV</a> mode.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <h3>Dummy Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>The dummy for a <code>ColorPicker</code> contains many sub widgets that are created
and added in the <code>createDummyChildren</code> method.</p>

<p>Additionally, there's two <code>span</code> that serve to display the original color
in comparison next to the current color.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">createDummy</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="nv">dummy </span><span class="o">=</span> <span class="nx">$</span> <span class="s">&quot;&lt;span class=&#39;colorpicker&#39;&gt;</span>
<span class="s">                &lt;span class=&#39;newColor&#39;&gt;&lt;/span&gt;</span>
<span class="s">                &lt;span class=&#39;oldColor&#39;&gt;&lt;/span&gt;</span>
<span class="s">               &lt;/span&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>Clicking on the original color reset the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">dummy</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&quot;.oldColor&quot;</span><span class="p">).</span><span class="nv">click </span><span class="o">=&gt;</span>
      <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="py">@originalValue</span>

    <span class="nx">dummy</span></pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Creates the widgets used by the dialog to manipulate
the color's components.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">createDummyChildren</span><span class="o">:</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>There's one <code>TextInput</code> for each component of the color
for both the <code>rgb</code> and <code>hsv</code> color space. And for each
components input, a <code>Radio</code> button is placed next to it
to allow the selection of the corresponding mode.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@add</span> <span class="py">@redInput</span>        <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="py">@add</span> <span class="py">@redMode</span>         <span class="o">=</span> <span class="py">@newRadio</span> <span class="s">&quot;red&quot;</span>

    <span class="py">@add</span> <span class="py">@greenInput</span>      <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;green&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="py">@add</span> <span class="py">@greenMode</span>       <span class="o">=</span> <span class="py">@newRadio</span> <span class="s">&quot;green&quot;</span>

    <span class="py">@add</span> <span class="py">@blueInput</span>       <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="py">@add</span> <span class="py">@blueMode</span>        <span class="o">=</span> <span class="py">@newRadio</span> <span class="s">&quot;blue&quot;</span>

    <span class="py">@add</span> <span class="py">@hueInput</span>        <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;hue&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="py">@add</span> <span class="py">@hueMode</span>         <span class="o">=</span> <span class="py">@newRadio</span> <span class="s">&quot;hue&quot;</span><span class="p">,</span> <span class="kc">true</span>

    <span class="py">@add</span> <span class="py">@saturationInput</span> <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;saturation&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="py">@add</span> <span class="py">@saturationMode</span>  <span class="o">=</span> <span class="py">@newRadio</span> <span class="s">&quot;saturation&quot;</span>

    <span class="py">@add</span> <span class="py">@valueInput</span>      <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="py">@add</span> <span class="py">@valueMode</span>       <span class="o">=</span> <span class="py">@newRadio</span> <span class="s">&quot;value&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>One for the hexadecimal form.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@add</span> <span class="py">@hexInput</span>        <span class="o">=</span> <span class="py">@newInput</span> <span class="s">&quot;hex&quot;</span><span class="p">,</span> <span class="mi">6</span></pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>And two <code>SquarePicker</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@add</span> <span class="py">@squarePicker</span>    <span class="o">=</span> <span class="k">new</span> <span class="nb">SquarePicker</span>
    <span class="py">@add</span> <span class="py">@rangePicker</span>     <span class="o">=</span> <span class="k">new</span> <span class="nb">SquarePicker</span></pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>One of the <code>SquarePicker</code> is locked on the x axis.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@rangePicker</span><span class="p">.</span><span class="nx">lockX</span><span class="p">()</span>
    <span class="py">@rangePicker</span><span class="p">.</span><span class="nx">addClasses</span> <span class="s">&quot;vertical&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>Creates a <code>TextInput</code> with a maximum length of <code>maxlength</code>
and add the <code>cls</code> class to the input's dummy.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">newInput</span><span class="o">:</span> <span class="p">(</span><span class="nx">cls</span><span class="p">,</span> <span class="nx">maxlength</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">input </span><span class="o">=</span> <span class="k">new</span> <span class="nb">TextInput</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">addClasses</span> <span class="nx">cls</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;maxlength&quot;</span><span class="p">,</span> <span class="nx">maxlength</span></pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>The <code>ColorPicker</code> listen to all the children
<code>TextInput</code>s. The class added to the input is passed
to the listener to differenciate each input.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">input</span><span class="p">.</span><span class="nx">valueChanged</span><span class="p">.</span><span class="nx">add</span> <span class="p">(</span><span class="nx">w</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="py">@inputValueChanged</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">cls</span>
      <span class="kc">true</span>

    <span class="nx">input</span></pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>Creates a <code>Radio</code> with the specified class. Optionally
the checked property of the radio can be set to <code>true</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">newRadio</span><span class="o">:</span> <span class="p">(</span><span class="nx">cls</span><span class="p">,</span> <span class="nv">checked</span><span class="o">=</span><span class="kc">false</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">radio </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Radio</span>
    <span class="nx">radio</span><span class="p">.</span><span class="nx">addClasses</span> <span class="nx">cls</span>
    <span class="nx">radio</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;checked&quot;</span><span class="p">,</span> <span class="nx">checked</span></pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>Radios are automatically added in the group.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@modesGroup</span><span class="p">.</span><span class="nx">add</span> <span class="nx">radio</span>
    <span class="nx">radio</span></pre></div>             </td>           </tr>                               <tr id="section-111">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-111">&#182;</a>               </div>               <p>Invalidates the widget to force an update.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">invalidate</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@update</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-112">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-112">&#182;</a>               </div>               <p>Since the <code>update</code> method can be called in the listener
of the <code>change</code> event of one of the children input the
value of this input cannot be change at that time.</p>

<p>It means that if the submitted value was invalid, the widget
will not be able to revert to the initial value at the time
of the <code>update</code> call.</p>

<p>The <code>update</code> method will then be called again with a small delay
to let the input end its event dispatch.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">setTimeout </span><span class="o">=&gt;</span>
      <span class="py">@update</span><span class="p">()</span>
    <span class="p">,</span> <span class="mi">10</span></pre></div>             </td>           </tr>                               <tr id="section-113">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-113">&#182;</a>               </div>               <p>Updates the current widget's value after changes made
to its children, the other children are also updated
with the current color components.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">update</span><span class="o">:</span> <span class="p">()</span> <span class="o">-&gt;</span>

    <span class="nv">rnd </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span></pre></div>             </td>           </tr>                               <tr id="section-114">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-114">&#182;</a>               </div>               <p>The color's components are stored in individual variables.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">{</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">}</span> <span class="o">=</span> <span class="py">@model</span></pre></div>             </td>           </tr>                               <tr id="section-115">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-115">&#182;</a>               </div>               <p>The hexadecimal form is produced from the current red,
green and blue.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">value </span><span class="o">=</span> <span class="nx">rgb2hex</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-116">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-116">&#182;</a>               </div>               <p>The hexadecimal value is then affected as the
new value for this widgets.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@</span><span class="p">[</span><span class="s">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;#</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-117">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-117">&#182;</a>               </div>               <p>All the affectation below will trigger <code>valueChanged</code> signals
on the children widgets, so the lock is activated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@inputValueSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-118">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-118">&#182;</a>               </div>               <p>The current edit mode is updated as well with the current model.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@get</span><span class="p">(</span><span class="s">&quot;mode&quot;</span><span class="p">).</span><span class="nx">update</span> <span class="py">@model</span></pre></div>             </td>           </tr>                               <tr id="section-119">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-119">&#182;</a>               </div>               <p>Each <code>TextInput</code> receive its new value. Each components value
for the <code>rgb</code> and <code>hsv</code> color space are rounded before affectation.
That way the model always stores discret values to avoid
inconsistencies in conversion results.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@updateInput</span> <span class="py">@redInput</span><span class="p">,</span>        <span class="nx">rnd</span> <span class="nx">r</span>
    <span class="py">@updateInput</span> <span class="py">@greenInput</span><span class="p">,</span>      <span class="nx">rnd</span> <span class="nx">g</span>
    <span class="py">@updateInput</span> <span class="py">@blueInput</span><span class="p">,</span>       <span class="nx">rnd</span> <span class="nx">b</span>
    <span class="py">@updateInput</span> <span class="py">@hueInput</span><span class="p">,</span>        <span class="nx">rnd</span> <span class="nx">h</span>
    <span class="py">@updateInput</span> <span class="py">@saturationInput</span><span class="p">,</span> <span class="nx">rnd</span> <span class="nx">s</span>
    <span class="py">@updateInput</span> <span class="py">@valueInput</span><span class="p">,</span>      <span class="nx">rnd</span> <span class="nx">v</span>
    <span class="py">@updateInput</span> <span class="py">@hexInput</span><span class="p">,</span>        <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-120">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-120">&#182;</a>               </div>               <p>The lock is released.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@inputValueSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-121">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-121">&#182;</a>               </div>               <p>Finally the color preview <code>span</code> is updated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@dummy</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&quot;.newColor&quot;</span><span class="p">).</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;background: #</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-122">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-122">&#182;</a>               </div>               <p>Updates the value of the specified input.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">updateInput</span><span class="o">:</span> <span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="nx">value</span>

  <span class="py">setupDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">colorinput</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-123">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-123">&#182;</a>               </div>               <p>The original value is stored for allow a later reset.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@originalValue</span> <span class="o">=</span> <span class="nv">value </span><span class="o">=</span> <span class="py">@caller</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-124">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-124">&#182;</a>               </div>               <p>The dialog's value is set on the current <code>ColorInput</code> value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-125">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-125">&#182;</a>               </div>               <p>And the <code>span</code> meant to display the original value is updated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@dummy</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&quot;.oldColor&quot;</span><span class="p">).</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;background: </span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-126">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-126">&#182;</a>               </div>               <h3>Comfirmation And Cancelation</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-127">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-127">&#182;</a>               </div>               <p>Handles the changes comfirmation with the <code>Enter</code> key.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">comfirmChangesOnEnter</span><span class="o">:</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-128">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-128">&#182;</a>               </div>               <p>If the command is triggered when on of the children inputs
has changes that haven't trigger a <code>change</code> event, the
widgets prevent the comfirmation to allow the submission
of the changes made to this input.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">unless</span> <span class="py">@redInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span>        <span class="o">or</span>
           <span class="py">@greenInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span>      <span class="o">or</span>
           <span class="py">@blueInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span>       <span class="o">or</span>
           <span class="py">@hueInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span>        <span class="o">or</span>
           <span class="py">@saturationInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span> <span class="o">or</span>
           <span class="py">@valueInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span>      <span class="o">or</span>
           <span class="py">@hexInput</span><span class="p">.</span><span class="nx">valueIsObsolete</span>
      <span class="py">@comfirmChanges</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-129">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-129">&#182;</a>               </div>               <p>Comfirm the changes to the <code>ColorInput</code>. The dialog is hidden
a the end of the call.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">comfirmChanges</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@caller</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="py">@get</span> <span class="s">&quot;value&quot;</span>
    <span class="py">@close</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-130">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-130">&#182;</a>               </div>               <h3>Properties Accessors</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-131">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-131">&#182;</a>               </div>               <p>Changes the color edit mode for this dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_mode</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="nv">oldMode </span><span class="o">=</span> <span class="py">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span>

    <span class="nx">oldMode</span><span class="p">.</span><span class="nx">dispose</span><span class="p">()</span> <span class="k">if</span> <span class="nx">oldMode</span><span class="o">?</span>
    <span class="k">if</span> <span class="nx">value</span><span class="o">?</span>
      <span class="nx">value</span><span class="p">.</span><span class="nx">init</span> <span class="k">this</span>
      <span class="nx">value</span><span class="p">.</span><span class="nx">update</span> <span class="py">@model</span>

    <span class="py">@</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-132">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-132">&#182;</a>               </div>               <p>Changing the widget's value using the <code>value</code> setter
will feed the model with completely new datas from the passed-in color.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">set_value</span><span class="o">:</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="py">@get</span> <span class="s">&quot;value&quot;</span> <span class="k">unless</span> <span class="nx">isValidValue</span> <span class="nx">value</span>

    <span class="py">@fromHex</span> <span class="nx">value</span>
    <span class="k">super</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-133">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-133">&#182;</a>               </div>               <h3>Internal Modification Methods</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-134">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-134">&#182;</a>               </div>               <p>Sets the widget's model with an hexadecimal color.
The <code>#</code> prefix is optional.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">fromHex</span><span class="o">:</span> <span class="p">(</span><span class="nx">hex</span><span class="p">)</span> <span class="o">-&gt;</span>

    <span class="nv">v </span><span class="o">=</span> <span class="k">if</span> <span class="nx">hex</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="s">&quot;#</span><span class="si">#{</span><span class="nx">hex</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">else</span> <span class="nx">hex</span>

    <span class="k">if</span> <span class="nx">isValidValue</span> <span class="nx">v</span>
      <span class="p">{</span><span class="py">red</span><span class="o">:</span> <span class="nx">r</span><span class="p">,</span> <span class="py">green</span><span class="o">:</span> <span class="nx">g</span><span class="p">,</span> <span class="py">blue</span><span class="o">:</span> <span class="nx">b</span><span class="p">}</span> <span class="o">=</span> <span class="nx">colorObjectFromValue</span> <span class="nx">v</span>
      <span class="py">@fromRGB</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-135">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-135">&#182;</a>               </div>               <p>Sets the widget's model with the three components of a <code>rgb</code> color.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">fromRGB</span><span class="o">:</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>

    <span class="nv">r </span><span class="o">=</span> <span class="nb">parseFloat</span> <span class="nx">r</span>
    <span class="nv">g </span><span class="o">=</span> <span class="nb">parseFloat</span> <span class="nx">g</span>
    <span class="nv">b </span><span class="o">=</span> <span class="nb">parseFloat</span> <span class="nx">b</span>

    <span class="k">if</span> <span class="nx">isValidRGB</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
      <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rgb2hsv</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
      <span class="py">@model</span> <span class="o">=</span> <span class="py">r</span><span class="o">:</span><span class="nx">r</span><span class="p">,</span> <span class="py">g</span><span class="o">:</span><span class="nx">g</span><span class="p">,</span> <span class="py">b</span><span class="o">:</span><span class="nx">b</span><span class="p">,</span> <span class="py">h</span><span class="o">:</span><span class="nx">h</span><span class="p">,</span> <span class="py">s</span><span class="o">:</span><span class="nx">s</span><span class="p">,</span> <span class="py">v</span><span class="o">:</span> <span class="nx">v</span>

    <span class="py">@invalidate</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-136">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-136">&#182;</a>               </div>               <p>Sets the widget's model with the three components of a <code>hsv</code> color.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">fromHSV</span><span class="o">:</span> <span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>

    <span class="nv">h </span><span class="o">=</span> <span class="nb">parseFloat</span> <span class="nx">h</span>
    <span class="nv">s </span><span class="o">=</span> <span class="nb">parseFloat</span> <span class="nx">s</span>
    <span class="nv">v </span><span class="o">=</span> <span class="nb">parseFloat</span> <span class="nx">v</span>

    <span class="k">if</span> <span class="nx">isValidHSV</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span>
      <span class="p">[</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hsv2rgb</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span>
      <span class="py">@model</span> <span class="o">=</span> <span class="py">r</span><span class="o">:</span><span class="nx">r</span><span class="p">,</span> <span class="py">g</span><span class="o">:</span><span class="nx">g</span><span class="p">,</span> <span class="py">b</span><span class="o">:</span><span class="nx">b</span><span class="p">,</span> <span class="py">h</span><span class="o">:</span><span class="nx">h</span><span class="p">,</span> <span class="py">s</span><span class="o">:</span><span class="nx">s</span><span class="p">,</span> <span class="py">v</span><span class="o">:</span> <span class="nx">v</span>

    <span class="py">@invalidate</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-137">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-137">&#182;</a>               </div>               <h3>Signal Handlers</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-138">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-138">&#182;</a>               </div>               <p>Catches the change made to the <code>RadioGroup</code> selection
and affect the corresponding edit mode.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">modeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">oldSel</span><span class="p">,</span> <span class="nx">newSel</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">switch</span> <span class="nx">newSel</span>
      <span class="k">when</span> <span class="py">@redMode</span>        <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">when</span> <span class="py">@greenMode</span>      <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">when</span> <span class="py">@blueMode</span>       <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">when</span> <span class="py">@hueMode</span>        <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="k">when</span> <span class="py">@saturationMode</span> <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
      <span class="k">when</span> <span class="py">@valueMode</span>      <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;mode&quot;</span><span class="p">,</span> <span class="py">@editModes</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-139">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-139">&#182;</a>               </div>               <p>Receives the <code>valueChanged</code> signals from the children inputs.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">inputValueChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">component</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-140">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-140">&#182;</a>               </div>               <p>But if the lock is activated the function will not proceed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">unless</span> <span class="py">@inputValueSetProgrammatically</span>

      <span class="p">{</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">}</span> <span class="o">=</span> <span class="py">@model</span></pre></div>             </td>           </tr>                               <tr id="section-141">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-141">&#182;</a>               </div>               <p>According to the component the widget's value is changed.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">switch</span> <span class="nx">component</span>
        <span class="k">when</span> <span class="s">&quot;red&quot;</span>        <span class="k">then</span> <span class="py">@fromRGB</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
        <span class="k">when</span> <span class="s">&quot;green&quot;</span>      <span class="k">then</span> <span class="py">@fromRGB</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">b</span>
        <span class="k">when</span> <span class="s">&quot;blue&quot;</span>       <span class="k">then</span> <span class="py">@fromRGB</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">value</span>

        <span class="k">when</span> <span class="s">&quot;hue&quot;</span>        <span class="k">then</span> <span class="py">@fromHSV</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span>
        <span class="k">when</span> <span class="s">&quot;saturation&quot;</span> <span class="k">then</span> <span class="py">@fromHSV</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">v</span>
        <span class="k">when</span> <span class="s">&quot;value&quot;</span>      <span class="k">then</span> <span class="py">@fromHSV</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">value</span>

        <span class="k">when</span> <span class="s">&quot;hex&quot;</span>        <span class="k">then</span> <span class="py">@fromHex</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-142">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-142">&#182;</a>               </div>               <h1>Color Manipulation Modes</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-143">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-143">&#182;</a>               </div>               <p><a name ="AbstractMode"></a></p>

<h3>AbstractMode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-144">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-144">&#182;</a>               </div>               <p>The abstract class provides some basic behavior that are shared
by each mode.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">AbstractMode</span></pre></div>             </td>           </tr>                               <tr id="section-145">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-145">&#182;</a>               </div>               <p>Registers the dialog that own the color mode.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@dialog</span> <span class="o">=</span> <span class="nx">dialog</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-146">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-146">&#182;</a>               </div>               <p>The <code>dispose</code> methods unregisters the signals listeners
and remove the content the mode added to the dialog.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">dispose</span><span class="o">:</span> <span class="o">-&gt;</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">valueChanged</span><span class="p">.</span><span class="nx">remove</span> <span class="py">@rangeChanged</span><span class="p">,</span> <span class="k">this</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">valueChanged</span><span class="p">.</span><span class="nx">remove</span> <span class="py">@squareChanged</span><span class="p">,</span> <span class="k">this</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&quot;.layer&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&quot;.layer&quot;</span><span class="p">).</span><span class="nx">remove</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-147">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-147">&#182;</a>               </div>               <p>Initialize the setup for the two <code>SquarePicker</code> owns
by the <code>ColorPicker</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="py">initPickers</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">s</span><span class="p">)</span> <span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-148">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-148">&#182;</a>               </div>               <p>The <code>a</code>, <code>b</code> and <code>c</code> arguments are the three ranges for the
axis of the <code>SquarePicker</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span>
      <span class="py">rangeX</span><span class="o">:</span> <span class="nx">a</span>
      <span class="py">rangeY</span><span class="o">:</span> <span class="nx">b</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span>
      <span class="py">rangeY</span><span class="o">:</span> <span class="nx">c</span></pre></div>             </td>           </tr>                               <tr id="section-149">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-149">&#182;</a>               </div>               <p>Listeners are automatically registered on the <code>valueChanged</code>
signals of the <code>SquarePicker</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">valueChanged</span><span class="p">.</span><span class="nx">add</span> <span class="py">@rangeChanged</span><span class="p">,</span> <span class="k">this</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">valueChanged</span><span class="p">.</span><span class="nx">add</span> <span class="py">@squareChanged</span><span class="p">,</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-150">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-150">&#182;</a>               </div>               <p>The additionnal content is built and added in the <code>SquarePicker</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">prepend</span> <span class="nx">$</span> <span class="nx">r</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">prepend</span> <span class="nx">$</span> <span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-151">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-151">&#182;</a>               </div>               <p><a name ="HSV"></a></p>

<h3>HSV Mode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-152">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-152">&#182;</a>               </div>               <p>The <code>HSVMode</code> setup the <code>ColorPicker</code> such as the
vertical ramp edit the <code>hue</code> component and the square
picker edit the <code>saturation</code> and <code>value</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">HSVMode</span> <span class="k">extends</span> <span class="nb">AbstractMode</span>
  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">dialog</span>

    <span class="py">@initPickers</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">],</span>
                 <span class="s">&quot;&lt;span class=&#39;layer hue-vertical-ramp&#39;&gt;&lt;/span&gt;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;&lt;span class=&#39;layer&#39;&gt;</span>
<span class="s">                    &lt;span class=&#39;layer hue-color&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer white-horizontal-ramp&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer black-vertical-ramp&#39;&gt;&lt;/span&gt;</span>
<span class="s">                  &lt;/span&gt;&quot;</span>

  <span class="py">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">model</span><span class="o">?</span>
      <span class="p">{</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">}</span> <span class="o">=</span> <span class="nx">model</span>
      <span class="p">[</span><span class="nx">r</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">b</span><span class="p">]</span> <span class="o">=</span> <span class="nx">hsv2rgb</span> <span class="nx">h</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span>

      <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>

      <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">s</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">v</span><span class="p">]</span>
      <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="o">-</span><span class="nx">h</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-153">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-153">&#182;</a>               </div>               <p>The <code>HSV</code> mode change the background of the lowest
additional span with the current hue at full saturation
and value.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">value </span><span class="o">=</span> <span class="nx">rgb2hex</span> <span class="nx">r</span><span class="p">,</span><span class="nx">g</span><span class="p">,</span><span class="nx">b</span>
      <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.hue-color&quot;</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;background: #</span><span class="si">#{</span><span class="nx">value</span><span class="si">}</span><span class="s">;&quot;</span>

      <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">updateDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">fromHSV</span> <span class="mi">360</span><span class="o">-</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">v</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">squareChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nv">h </span><span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span>

  <span class="py">rangeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span>
      <span class="nv">h </span><span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-154">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-154">&#182;</a>               </div>               <p><a name ="SHV"></a></p>

<h3>SHV Mode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-155">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-155">&#182;</a>               </div>               <p>The <code>SHVMode</code> setup the <code>ColorPicker</code> such as the
vertical ramp edit the <code>saturation</code> component and the square
picker edit the <code>hue</code> and <code>value</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">SHVMode</span> <span class="k">extends</span> <span class="nb">AbstractMode</span>
  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">dialog</span>

    <span class="py">@initPickers</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                 <span class="s">&quot;&lt;span class=&#39;layer black-white-vertical-ramp&#39;&gt;&lt;/span&gt;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;&lt;span class=&#39;layer&#39;&gt;</span>
<span class="s">                    &lt;span class=&#39;layer hue-horizontal-ramp&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer white-plain&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer black-vertical-ramp&#39;&gt;&lt;/span&gt;</span>
<span class="s">                  &lt;/span&gt;&quot;</span>

  <span class="py">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">model</span>
    <span class="nv">opacity </span><span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nx">s</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">360</span><span class="o">-</span><span class="nx">h</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">v</span><span class="p">]</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">s</span><span class="p">]</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.white-plain&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;opacity: </span><span class="si">#{</span><span class="nx">opacity</span><span class="si">}</span><span class="s">;&quot;</span>

  <span class="py">updateDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">fromHSV</span> <span class="mi">360</span><span class="o">-</span><span class="nx">h</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">s</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">v</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">squareChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nv">s </span><span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span>

  <span class="py">rangeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">v</span><span class="p">]</span> <span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span>
      <span class="nv">s </span><span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-156">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-156">&#182;</a>               </div>               <p><a name ="VHS"></a></p>

<h3>VHS Mode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-157">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-157">&#182;</a>               </div>               <p>The <code>VHSMode</code> setup the <code>ColorPicker</code> such as the
vertical ramp edit the <code>value</code> component and the square
picker edit the <code>saturation</code> and <code>hue</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">VHSMode</span> <span class="k">extends</span> <span class="nb">AbstractMode</span>
  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">dialog</span>

    <span class="py">@initPickers</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                 <span class="s">&quot;&lt;span class=&#39;layer black-white-vertical-ramp&#39;&gt;&lt;/span&gt;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;&lt;span class=&#39;layer&#39;&gt;</span>
<span class="s">                    &lt;span class=&#39;layer hue-horizontal-ramp&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer white-vertical-ramp&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer black-plain&#39;&gt;&lt;/span&gt;</span>
<span class="s">                  &lt;/span&gt;&quot;</span>

  <span class="py">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">}</span> <span class="o">=</span> <span class="nx">model</span>
    <span class="nv">opacity </span><span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="nx">v</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">360</span><span class="o">-</span><span class="nx">h</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">s</span><span class="p">]</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">v</span><span class="p">]</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.black-plain&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;opacity: </span><span class="si">#{</span><span class="nx">opacity</span><span class="si">}</span><span class="s">;&quot;</span>

  <span class="py">updateDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">fromHSV</span> <span class="mi">360</span><span class="o">-</span><span class="nx">h</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">s</span><span class="p">,</span> <span class="mi">100</span><span class="o">-</span><span class="nx">v</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">squareChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nv">v </span><span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span>

  <span class="py">rangeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">]</span> <span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span>
      <span class="nv">v </span><span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">v</span></pre></div>             </td>           </tr>                               <tr id="section-158">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-158">&#182;</a>               </div>               <p><a name ="RGB"></a></p>

<h3>RGB Mode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-159">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-159">&#182;</a>               </div>               <p>The <code>RGBMode</code> setup the <code>ColorPicker</code> such as the
vertical ramp edit the <code>red</code> component and the square
picker edit the <code>green</code> and <code>blue</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">RGBMode</span> <span class="k">extends</span> <span class="nb">AbstractMode</span>
  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">dialog</span>

    <span class="py">@initPickers</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="s">&quot;&lt;span class=&#39;layer black-red-vertical-ramp&#39;&gt;&lt;/span&gt;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;&lt;span class=&#39;layer&#39;&gt;</span>
<span class="s">                    &lt;span class=&#39;layer rgb-bottom&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer rgb-up&#39;&gt;&lt;/span&gt;</span>
<span class="s">                  &lt;/span&gt;&quot;</span>

  <span class="py">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">}</span> <span class="o">=</span> <span class="nx">model</span>
    <span class="nv">opacity </span><span class="o">=</span> <span class="nx">r</span> <span class="o">/</span> <span class="mi">255</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="mi">255</span><span class="o">-</span><span class="nx">g</span><span class="p">]</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="o">-</span><span class="nx">r</span><span class="p">]</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.rgb-up&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;opacity: </span><span class="si">#{</span><span class="nx">opacity</span><span class="si">}</span><span class="s">;&quot;</span>

  <span class="py">updateDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">fromRGB</span> <span class="mi">255</span><span class="o">-</span><span class="nx">r</span><span class="p">,</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">squareChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">g</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nv">r </span><span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>

  <span class="py">rangeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">g</span><span class="p">]</span> <span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span>
      <span class="nv">r </span><span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-160">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-160">&#182;</a>               </div>               <p><a name ="GRB"></a></p>

<h3>GRB Mode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-161">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-161">&#182;</a>               </div>               <p>The <code>RGBMode</code> setup the <code>ColorPicker</code> such as the
vertical ramp edit the <code>green</code> component and the square
picker edit the <code>red</code> and <code>blue</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">GRBMode</span> <span class="k">extends</span> <span class="nb">AbstractMode</span>
  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">dialog</span>

    <span class="py">@initPickers</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="s">&quot;&lt;span class=&#39;layer black-green-vertical-ramp&#39;&gt;&lt;/span&gt;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;&lt;span class=&#39;layer&#39;&gt;</span>
<span class="s">                    &lt;span class=&#39;layer grb-bottom&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer grb-up&#39;&gt;&lt;/span&gt;</span>
<span class="s">                  &lt;/span&gt;&quot;</span>

  <span class="py">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">}</span> <span class="o">=</span> <span class="nx">model</span>
    <span class="nv">opacity </span><span class="o">=</span> <span class="nx">g</span> <span class="o">/</span> <span class="mi">255</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="mi">255</span><span class="o">-</span><span class="nx">r</span><span class="p">]</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="o">-</span><span class="nx">g</span><span class="p">]</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.grb-up&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;opacity: </span><span class="si">#{</span><span class="nx">opacity</span><span class="si">}</span><span class="s">;&quot;</span>

  <span class="py">updateDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">fromRGB</span> <span class="mi">255</span><span class="o">-</span><span class="nx">r</span><span class="p">,</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">squareChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">r</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nv">g </span><span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>

  <span class="py">rangeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">b</span><span class="p">,</span> <span class="nx">r</span><span class="p">]</span> <span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span>
      <span class="nv">g </span><span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-162">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-162">&#182;</a>               </div>               <p><a name ="BGR"></a></p>

<h3>BGR Mode</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-163">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-163">&#182;</a>               </div>               <p>The <code>RGBMode</code> setup the <code>ColorPicker</code> such as the
vertical ramp edit the <code>blue</code> component and the square
picker edit the <code>green</code> and <code>red</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nb">BGRMode</span> <span class="k">extends</span> <span class="nb">AbstractMode</span>
  <span class="py">init</span><span class="o">:</span> <span class="p">(</span><span class="nx">dialog</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">super</span> <span class="nx">dialog</span>

    <span class="py">@initPickers</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
                 <span class="s">&quot;&lt;span class=&#39;layer black-blue-vertical-ramp&#39;&gt;&lt;/span&gt;&quot;</span><span class="p">,</span>
                 <span class="s">&quot;&lt;span class=&#39;layer&#39;&gt;</span>
<span class="s">                    &lt;span class=&#39;layer bgr-bottom&#39;&gt;&lt;/span&gt;</span>
<span class="s">                    &lt;span class=&#39;layer bgr-up&#39;&gt;&lt;/span&gt;</span>
<span class="s">                  &lt;/span&gt;&quot;</span>

  <span class="py">update</span><span class="o">:</span> <span class="p">(</span><span class="nx">model</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="p">{</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">}</span> <span class="o">=</span> <span class="nx">model</span>
    <span class="nv">opacity </span><span class="o">=</span> <span class="nx">b</span> <span class="o">/</span> <span class="mi">255</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">g</span><span class="p">,</span> <span class="mi">255</span><span class="o">-</span><span class="nx">r</span><span class="p">]</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="o">-</span><span class="nx">b</span><span class="p">]</span>

    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.bgr-up&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="s">&quot;opacity: </span><span class="si">#{</span><span class="nx">opacity</span><span class="si">}</span><span class="s">;&quot;</span>

  <span class="py">updateDialog</span><span class="o">:</span> <span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="py">@dialog</span><span class="p">.</span><span class="nx">fromRGB</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="mi">255</span> <span class="o">-</span> <span class="nx">b</span>
    <span class="py">@valuesSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="py">squareChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">g</span><span class="p">,</span> <span class="nx">r</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
      <span class="nv">b </span><span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">rangePicker</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span>

  <span class="py">rangeChanged</span><span class="o">:</span> <span class="p">(</span><span class="nx">widget</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="py">@valuesSetProgrammatically</span>
      <span class="p">[</span><span class="nx">g</span><span class="p">,</span> <span class="nx">r</span><span class="p">]</span> <span class="o">=</span> <span class="py">@dialog</span><span class="p">.</span><span class="nx">squarePicker</span><span class="p">.</span><span class="nx">get</span> <span class="s">&quot;value&quot;</span>
      <span class="nv">b </span><span class="o">=</span> <span class="nx">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

      <span class="py">@updateDialog</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">b</span></pre></div>             </td>           </tr>                               <tr id="section-164">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-164">&#182;</a>               </div>               <p>Setup a unique instance of <code>ColorPicker</code> as the default listener
for <code>ColorInput</code> instances.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">ColorInput</span><span class="p">.</span><span class="nv">defaultListener </span><span class="o">=</span> <span class="k">new</span> <span class="nb">ColorPicker</span>

<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span> <span class="o">-&gt;</span> <span class="nb">ColorInput</span><span class="p">.</span><span class="nx">defaultListener</span><span class="p">.</span><span class="nx">attach</span> <span class="s">&quot;body&quot;</span>

<span class="py">@rgb2hsv</span>      <span class="o">=</span> <span class="nx">rgb2hsv</span>
<span class="py">@hsv2rgb</span>      <span class="o">=</span> <span class="nx">hsv2rgb</span>
<span class="py">@ColorInput</span>   <span class="o">=</span> <span class="nb">ColorInput</span>
<span class="py">@SquarePicker</span> <span class="o">=</span> <span class="nb">SquarePicker</span>
<span class="py">@ColorPicker</span>  <span class="o">=</span> <span class="nb">ColorPicker</span>
<span class="py">@HSVMode</span>      <span class="o">=</span> <span class="nb">HSVMode</span>
<span class="py">@SHVMode</span>      <span class="o">=</span> <span class="nb">SHVMode</span>
<span class="py">@VHSMode</span>      <span class="o">=</span> <span class="nb">VHSMode</span>
<span class="py">@RGBMode</span>      <span class="o">=</span> <span class="nb">RGBMode</span>
<span class="py">@GRBMode</span>      <span class="o">=</span> <span class="nb">GRBMode</span>
<span class="py">@BGRMode</span>      <span class="o">=</span> <span class="nb">BGRMode</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 