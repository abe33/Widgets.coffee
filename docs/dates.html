<!DOCTYPE html>  <html> <head>   <title>dates.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="button.html">                 button.coffee               </a>                                           <a class="source" href="checkbox.html">                 checkbox.coffee               </a>                                           <a class="source" href="colorpicker.html">                 colorpicker.coffee               </a>                                           <a class="source" href="container.html">                 container.coffee               </a>                                           <a class="source" href="dates.html">                 dates.coffee               </a>                                           <a class="source" href="filepicker.html">                 filepicker.coffee               </a>                                           <a class="source" href="jquery.html">                 jquery.coffee               </a>                                           <a class="source" href="keys.html">                 keys.coffee               </a>                                           <a class="source" href="menus.html">                 menus.coffee               </a>                                           <a class="source" href="mixins.html">                 mixins.coffee               </a>                                           <a class="source" href="module.html">                 module.coffee               </a>                                           <a class="source" href="numeric-widget.html">                 numeric-widget.coffee               </a>                                           <a class="source" href="radio.html">                 radio.coffee               </a>                                           <a class="source" href="radiogroup.html">                 radiogroup.coffee               </a>                                           <a class="source" href="selects.html">                 selects.coffee               </a>                                           <a class="source" href="slider.html">                 slider.coffee               </a>                                           <a class="source" href="stepper.html">                 stepper.coffee               </a>                                           <a class="source" href="textarea.html">                 textarea.coffee               </a>                                           <a class="source" href="textinput.html">                 textinput.coffee               </a>                                           <a class="source" href="widgets.html">                 widgets.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               dates.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><link rel="stylesheet" href="../css/styles.css" media="screen">
<link rel="stylesheet" href="../css/widgets.css" media="screen"></p>

<script type='text/javascript' src='../depends/jquery-1.6.1.min.js'></script>

<script type='text/javascript'
        src='../depends/jquery.mousewheel.js'></script>

<script type='text/javascript' src='../depends/signals.js'></script>

<script type='text/javascript' src='../lib/widgets.js'></script>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The <code>dates.coffee</code> file contains all the widgets that handles date and time
related inputs.</p>

<p>The supported dates and time modes and their corresponding widgets are :</p>

<ul>
<li><a href="#time">time</a>                   :<a href="#TimeInput">TimeInput</a></li>
<li><a href="#date">date</a>                   :<a href="#DateInput">DateInput</a></li>
<li><a href="#month">month</a>                 :<a href="#MonthInput">MonthInput</a></li>
<li><a href="#week">week</a>                   :<a href="#WeekInput">WeekInput</a></li>
<li><a href="#datetime">datetime</a>           :<a href="#DateTimeInput">DateTimeInput</a></li>
<li><a href="#datetime-loca">datetime-local</a>:<a href="#DateTimeLocalInput">DateTimeLocalInput</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Utilities</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>A group of <em>"constants"</em> for basic time and dates computations.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">MILLISECONDS_IN_SECOND </span><span class="o">=</span> <span class="mi">1000</span>
<span class="nv">MILLISECONDS_IN_MINUTE </span><span class="o">=</span> <span class="nx">MILLISECONDS_IN_SECOND</span> <span class="o">*</span> <span class="mi">60</span>
<span class="nv">MILLISECONDS_IN_HOUR   </span><span class="o">=</span> <span class="nx">MILLISECONDS_IN_MINUTE</span> <span class="o">*</span> <span class="mi">60</span>
<span class="nv">MILLISECONDS_IN_DAY    </span><span class="o">=</span> <span class="nx">MILLISECONDS_IN_HOUR</span> <span class="o">*</span> <span class="mi">24</span>
<span class="nv">MILLISECONDS_IN_WEEK   </span><span class="o">=</span> <span class="nx">MILLISECONDS_IN_DAY</span> <span class="o">*</span> <span class="mi">7</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Cast the <code>value</code> into an integer.
In case the passed-in <code>value</code> cannot be casted in an
integer, the function return the value of <code>0</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">safeInt</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">n </span><span class="o">=</span> <span class="nb">parseInt</span> <span class="nx">value</span>
    <span class="k">unless</span> <span class="nb">isNaN</span> <span class="nx">n</span> <span class="k">then</span> <span class="nx">n</span> <span class="k">else</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Fills the string <code>s</code> with <code>0</code> until its length is
equal to the length <code>l</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">fill</span><span class="o">=</span><span class="p">(</span> <span class="nx">s</span><span class="p">,</span> <span class="nv">l </span><span class="o">=</span> <span class="mi">2</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">s </span><span class="o">=</span> <span class="nb">String</span> <span class="nx">s</span>
    <span class="nv">s </span><span class="o">=</span> <span class="s">&quot;0</span><span class="si">#{</span><span class="nx">s</span><span class="si">}</span><span class="s">&quot;</span> <span class="k">while</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="nx">l</span>
    <span class="nx">s</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>Abstract</h3>

<p>Validation and conversion functions for each mode are available
as top level functions to allow them to be tested and then
used in tests to validates widgets outputs.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>AbstractDateInputWidget</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>All widgets that implements support for one of the html
date and time inputs extends the <code>AbstractDateInputWidget</code> class.</p>

<p>The date widgets provides an additional <code>date</code> property,
accessible through a property accessor, that allow to manipulate
the widget's value using a <code>Date</code> instance.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">AbstractDateInputWidget</span> <span class="k">extends</span> <span class="nx">Widget</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Date and time widgets can operate in a range. Their prototype is then
decorated with the <code>ValueInRange</code> mixin.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@mixins</span> <span class="nx">ValueInRange</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Concretes classes must defines these properties before calling
the super constructor. The three functions handles the validation
and the conversion of value in <code>Date</code> objects when the <code>supportedType</code>
property define the value of the <code>type</code> attribute that a target must
have to be a valid target for the concrete widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">valueToDate  </span><span class="o">:</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span> <span class="k">new</span> <span class="nb">Date</span>
    <span class="py">dateToValue  </span><span class="o">:</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span> <span class="s">&quot;&quot;</span>
    <span class="py">isValidValue </span><span class="o">:</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span> <span class="kc">false</span>
    <span class="py">supportedType</span><span class="o">:</span><span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>The target can be either an <code>input</code> node with one of the date
types or a <code>Date</code> object.</p>

<p>The constructor supports an additional <code>defaultStep</code> argument
that will be used if the <code>step</code> property is not a number
before the validation of the value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span><span class="p">,</span> <span class="nv">defaultStep </span><span class="o">=</span> <span class="kc">null</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="nv">min  </span><span class="o">=</span> <span class="kc">null</span>
        <span class="nv">max  </span><span class="o">=</span> <span class="kc">null</span>
        <span class="nv">step </span><span class="o">=</span> <span class="kc">NaN</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>When the target is a date, we don't need to do much
operation.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">target</span> <span class="k">instanceof</span> <span class="nb">Date</span>
            <span class="k">super</span><span class="p">()</span>
            <span class="nv">date </span><span class="o">=</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>On the other hand, when the target is an input,
the datas contained in the node will be used to
setup the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span>
            <span class="k">super</span> <span class="nx">target</span>
            <span class="k">if</span> <span class="py">@hasTarget</span>
                <span class="nv">date  </span><span class="o">=</span> <span class="py">@dateFromAttribute</span>  <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span>
                <span class="nv">min   </span><span class="o">=</span> <span class="py">@valueFromAttribute</span> <span class="s">&quot;min&quot;</span>
                <span class="nv">max   </span><span class="o">=</span> <span class="py">@valueFromAttribute</span> <span class="s">&quot;max&quot;</span>
                <span class="nv">step  </span><span class="o">=</span> <span class="nb">parseInt</span> <span class="py">@valueFromAttribute</span> <span class="s">&quot;step&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>If invalid values are passed in the <code>min</code>
or <code>max</code> attribute, that attribute is set
to <code>null</code> and this extremity of the range
will not be used.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">unless</span> <span class="py">@isValidValue</span> <span class="nx">min</span> <span class="k">then</span> <span class="nv">min </span><span class="o">=</span> <span class="kc">null</span>
                <span class="k">unless</span> <span class="py">@isValidValue</span> <span class="nx">max</span> <span class="k">then</span> <span class="nv">max </span><span class="o">=</span> <span class="kc">null</span>
            <span class="k">else</span>
                <span class="nv">date  </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Step is step before any other operation. As <code>min</code>
<code>max</code> and <code>value</code> must respect that step.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@properties</span><span class="p">.</span><span class="nv">step  </span><span class="o">=</span> <span class="k">if</span> <span class="nb">isNaN</span> <span class="nx">step</span> <span class="k">then</span> <span class="nx">defaultStep</span> <span class="k">else</span> <span class="nx">step</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>If a valid <code>min</code> bounds is defined, the value is snapped
according to the <code>step</code> property before being its affectation.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">min</span><span class="o">?</span>
            <span class="nv">minDate </span><span class="o">=</span> <span class="py">@snapToStep</span> <span class="py">@valueToDate</span> <span class="nx">min</span>
            <span class="py">@properties</span><span class="p">.</span><span class="nv">min </span><span class="o">=</span> <span class="py">@dateToValue</span> <span class="nx">minDate</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>If a valid <code>max</code> bounds is defined, the value is snapped
according to the <code>step</code> property before being its affectation.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">max</span><span class="o">?</span>
            <span class="nv">maxDate </span><span class="o">=</span> <span class="py">@snapToStep</span> <span class="py">@valueToDate</span> <span class="nx">max</span>
            <span class="py">@properties</span><span class="p">.</span><span class="nv">max </span><span class="o">=</span> <span class="py">@dateToValue</span> <span class="nx">maxDate</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>The value of the widget is then adjusted itself to the step
and range defined previously.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@properties</span><span class="p">.</span><span class="nv">date  </span><span class="o">=</span> <span class="py">@fitToRange</span> <span class="nx">date</span><span class="p">,</span> <span class="nx">minDate</span><span class="p">,</span> <span class="nx">maxDate</span>
        <span class="py">@properties</span><span class="p">.</span><span class="nv">value </span><span class="o">=</span> <span class="py">@dateToValue</span> <span class="nx">date</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>To avoid infinite loops and unnecessary conversion, locks
are defined for the <code>date</code> and <code>value</code> setters.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@dateSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="py">@valueSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="py">@updateDummy</span><span class="p">()</span>
        <span class="py">@hideTarget</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Target Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Target must be an input with a type equal to the widget <code>supportedType</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">checkTarget</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">unless</span> <span class="py">@isInputWithType</span> <span class="nx">target</span><span class="p">,</span> <span class="py">@supportedType</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;&quot;&quot;TimeInput target must be an input</span>
<span class="s">                               with a </span><span class="si">#{</span> <span class="py">@supportedType</span> <span class="si">}</span><span class="s"> type&quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Gets a <code>Date</code> object from the value of a target's attribute.
If the target's value doesn't validate the <code>defaultValue</code>
is returned instead.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">dateFromAttribute</span><span class="o">:</span><span class="p">(</span> <span class="nx">attr</span><span class="p">,</span> <span class="nv">defaultValue </span><span class="o">=</span> <span class="kc">null</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="nv">value </span><span class="o">=</span> <span class="py">@valueFromAttribute</span> <span class="nx">attr</span>
        <span class="k">if</span> <span class="py">@isValidValue</span> <span class="nx">value</span> <span class="k">then</span> <span class="py">@valueToDate</span> <span class="nx">value</span> <span class="k">else</span> <span class="nx">defaultValue</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h3>Value Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Overrides of the <code>ValueInRange</code> mixin method to support date value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">snapToStep</span><span class="o">:</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>A <code>Date</code> is rounded using its primitive value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">ms </span><span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
        <span class="nv">step </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;step&quot;</span>
        <span class="k">if</span> <span class="nx">step</span><span class="o">?</span>
            <span class="nx">value</span><span class="p">.</span><span class="nx">setTime</span> <span class="nx">ms</span> <span class="o">-</span> <span class="p">(</span> <span class="nx">ms</span> <span class="o">%</span> <span class="p">(</span> <span class="nx">step</span> <span class="o">*</span> <span class="nx">MILLISECONDS_IN_SECOND</span> <span class="p">)</span> <span class="p">)</span>

        <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Overrides of the <code>ValueInRange</code> mixin method to support date value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">increment</span><span class="o">:</span><span class="p">()</span><span class="o">-&gt;</span>
        <span class="nv">d    </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span>
        <span class="nv">step </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;step&quot;</span>
        <span class="nv">ms   </span><span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">setTime</span> <span class="nx">ms</span> <span class="o">+</span> <span class="nx">step</span> <span class="o">*</span> <span class="nx">MILLISECONDS_IN_SECOND</span>
        <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="nx">d</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Overrides of the <code>ValueInRange</code> mixin method to support date value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">decrement</span><span class="o">:</span><span class="p">()</span><span class="o">-&gt;</span>
        <span class="nv">d    </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span>
        <span class="nv">step </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;step&quot;</span>
        <span class="nv">ms   </span><span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">setTime</span> <span class="nx">ms</span> <span class="o">-</span> <span class="nx">step</span> <span class="o">*</span> <span class="nx">MILLISECONDS_IN_SECOND</span>
        <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="nx">d</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h3>Dummy Management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>The base dummy for date widgets is a span with a <code>datetime</code>
class completed with the type of the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">createDummy</span><span class="o">:-&gt;</span>
        <span class="nx">$</span> <span class="s">&quot;&lt;span class=&#39;dateinput </span><span class="si">#{</span> <span class="py">@supportedType</span> <span class="si">}</span><span class="s">&#39;&gt;&lt;/span&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Placeholder for the dummy update.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">updateDummy</span><span class="o">:-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h3>Properties Accessors</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Sets the value of the widget with a <code>Date</code> instance.
Only valid dates are allowed. Invalid dates are easily
identifiable as all their getters will return <code>NaN</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">set_date</span><span class="o">:</span><span class="p">(</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">if</span> <span class="o">not</span> <span class="nx">value</span><span class="o">?</span> <span class="o">or</span> <span class="nb">isNaN</span> <span class="nx">value</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span>

        <span class="nv">min </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;min&quot;</span>
        <span class="nv">max </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;max&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>The <code>min</code> and <code>max</code> properties being stored as string,
they are converted to a date before being used.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">min</span><span class="o">?</span> <span class="k">then</span> <span class="nv">min </span><span class="o">=</span> <span class="py">@valueToDate</span> <span class="nx">min</span>
        <span class="k">if</span> <span class="nx">max</span><span class="o">?</span> <span class="k">then</span> <span class="nv">max </span><span class="o">=</span> <span class="py">@valueToDate</span> <span class="nx">max</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>The passed-in value is then adjusted to the widget's range.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span> <span class="o">=</span> <span class="py">@fitToRange</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The lock prevent a call to the <code>date</code> setter to call
back the <code>value</code> setter when <code>date</code> was called within
the <code>value</code> setter.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">unless</span> <span class="py">@dateSetProgrammatically</span>
            <span class="py">@valueSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="py">@dateToValue</span> <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span>
            <span class="py">@valueSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>The dummy is updated before returning the final value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@updateDummy</span><span class="p">()</span>
        <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Sets the value of the widget. Only valid values are allowed,
they are validated with the <code>isValidValue</code> function defined
for the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">set_value</span><span class="o">:</span><span class="p">(</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">unless</span> <span class="py">@isValidValue</span> <span class="nx">value</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>The lock prevent a call to the <code>value</code> setter to call
back the <code>date</code> setter when <code>value</code> was called within
the <code>date</code> setter.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">unless</span> <span class="py">@valueSetProgrammatically</span>
            <span class="py">@dateSetProgrammatically</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="py">@valueToDate</span> <span class="nx">value</span>
            <span class="py">@dateSetProgrammatically</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="k">super</span> <span class="nx">property</span><span class="p">,</span> <span class="py">@dateToValue</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>The dummy is updated before returning the final value.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@updateDummy</span><span class="p">()</span>
        <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>Sets the <code>min</code> property of the widget.</p>

<p>The <code>min</code> property is constrained by the same rules as the
widget's value. Meaning that it should returns true when
passed in <code>isValidValue</code> and then it will be snapped to the
widget's step.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">set_min</span><span class="o">:</span><span class="p">(</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">unless</span> <span class="py">@isValidValue</span> <span class="nx">value</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>The <code>min</code> property can't be greater that the <code>max</code> property.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">value</span> <span class="o">&gt;</span> <span class="py">@get</span> <span class="s">&quot;max&quot;</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span>

        <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span> <span class="o">=</span> <span class="py">@dateToValue</span> <span class="py">@snapToStep</span> <span class="py">@valueToDate</span> <span class="nx">value</span>
        <span class="py">@valueToAttribute</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>When affected, the current <code>date</code> of the widget is
adjusted to the new range by calling the <code>date</code> setter.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span>
        <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Sets the <code>max</code> property of the widget.</p>

<p>The <code>max</code> property is constrained by the same rules as the
widget's value. Meaning that it should returns true when
passed in <code>isValidValue</code> and then it will be snapped to the
widget's step.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">set_max</span><span class="o">:</span><span class="p">(</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">unless</span> <span class="py">@isValidValue</span> <span class="nx">value</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>The <code>max</code> property can't be greater that the <code>min</code> property.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nx">value</span> <span class="o">&lt;</span> <span class="py">@get</span> <span class="s">&quot;min&quot;</span> <span class="k">then</span> <span class="k">return</span> <span class="py">@get</span> <span class="nx">property</span>

        <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span> <span class="o">=</span> <span class="py">@dateToValue</span> <span class="py">@snapToStep</span> <span class="py">@valueToDate</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>When affected, the current <code>date</code> of the widget is
adjusted to the new range by calling the <code>date</code> setter.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@valueToAttribute</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span>
        <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span>
        <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Sets the <code>step</code> property of the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">set_step</span><span class="o">:</span><span class="p">(</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>A <code>null</code> or <code>NaN</code> step will disable the value snapping.
<code>NaN</code> value end up to <code>null</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="nb">isNaN</span> <span class="nx">value</span> <span class="k">then</span> <span class="nv">value </span><span class="o">=</span> <span class="kc">null</span>
        <span class="py">@properties</span><span class="p">[</span> <span class="nx">property</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">value</span>
        <span class="py">@valueToAttribute</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>When affected, the current <code>date</code> of the widget is
adjusted to the new step by calling the <code>date</code> setter.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="py">@get</span> <span class="s">&quot;date&quot;</span>
        <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><a name='time'></a></p>

<h1>Time</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Match if the passed-in string is a valid time string.
The following strings are considered as valid :
<code>10</code>, <code>10:15</code>, <code>10:15:40</code> or <code>10:15:40.768</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidTime</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="p">(</span><span class="sr">///</span> <span class="sro">^</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>                 <span class="c1"># Hours are required</span>
        <span class="sro">(</span><span class="sr">:</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>               <span class="c1"># Minutes are optional</span>
            <span class="sro">(</span><span class="sr">:</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>           <span class="c1"># Seconds as well</span>
                <span class="sro">(</span><span class="sr">\.</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">1,4</span><span class="sro">})?</span>  <span class="c1"># Milliseconds too</span>
            <span class="sro">)?</span>                  <span class="c1"># End Seconds</span>
        <span class="sro">)?</span>                      <span class="c1"># End Minutes</span>
    <span class="sro">$</span> <span class="sr">///</span><span class="p">).</span><span class="nx">test</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Converts a time string into a <code>Date</code> object where the time properties,
hours, minutes, seconds and milliseconds, are sets with the provided
datas or <code>0</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">timeFromString</span><span class="o">=</span><span class="p">(</span> <span class="nx">string</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="p">[</span> <span class="nx">hours</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">sec</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">split</span> <span class="s">&quot;:&quot;</span>
    <span class="p">[</span> <span class="nx">sec</span><span class="p">,</span> <span class="nx">ms</span> <span class="p">]</span> <span class="o">=</span> <span class="k">if</span> <span class="nx">sec</span><span class="o">?</span> <span class="k">then</span> <span class="nx">sec</span><span class="p">.</span><span class="nx">split</span> <span class="s">&quot;.&quot;</span> <span class="k">else</span> <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>UTC dates start at 1:00 AM so we have to remove one hour.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">time </span><span class="o">=</span> <span class="nx">safeInt</span><span class="p">(</span> <span class="nx">hours</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="o">*</span> <span class="nx">MILLISECONDS_IN_HOUR</span>   <span class="o">+</span>
           <span class="nx">safeInt</span><span class="p">(</span> <span class="nx">min</span> <span class="p">)</span>       <span class="o">*</span> <span class="nx">MILLISECONDS_IN_MINUTE</span> <span class="o">+</span>
           <span class="nx">safeInt</span><span class="p">(</span> <span class="nx">sec</span> <span class="p">)</span>       <span class="o">*</span> <span class="nx">MILLISECONDS_IN_SECOND</span> <span class="o">+</span>
           <span class="nx">safeInt</span><span class="p">(</span> <span class="nx">ms</span> <span class="p">)</span>

    <span class="nv">d </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="nx">time</span>
    <span class="nx">d</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Converts a <code>Date</code> object in a string such as <code>10:15:40</code>.
If the milliseconds count is different than <code>0</code> then the
output will look as <code>10:15:40.768</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">timeToString</span><span class="o">=</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">h  </span><span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getHours</span><span class="p">()</span>
    <span class="nv">m  </span><span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMinutes</span><span class="p">()</span>
    <span class="nv">s  </span><span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getSeconds</span><span class="p">()</span>
    <span class="nv">ms </span><span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMilliseconds</span><span class="p">()</span>

    <span class="nv">time </span><span class="o">=</span><span class="s">&quot;</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">h</span> <span class="si">}</span><span class="s">:</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">m</span> <span class="si">}</span><span class="s">:</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">s</span> <span class="si">}</span><span class="s">&quot;</span>

    <span class="k">if</span> <span class="nx">ms</span> <span class="o">isnt</span> <span class="mi">0</span>
        <span class="nx">time</span> <span class="o">+=</span> <span class="s">&quot;.</span><span class="si">#{</span> <span class="nx">ms</span> <span class="si">}</span><span class="s">&quot;</span>

    <span class="nx">time</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p><a name='TimeInput'></a></p>

<h3>TimeInput</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>The <code>TimeInput</code> handles the form input of type <code>time</code>.</p>

<p>Here some live instances :</p>

<div id="timeinput-demos"></div>

<script type='text/javascript'>
var f = function(){ console.log( "button clicked" ) };
var input1 = new TimeInput();
var input2 = new TimeInput();
var input3 = new TimeInput();

input2.set( "readonly", true );
input3.set( "disabled", true );

input1.attach("#timeinput-demos");
input2.attach("#timeinput-demos");
input3.attach("#timeinput-demos");
</script>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">TimeInput</span> <span class="k">extends</span> <span class="nx">AbstractDateInputWidget</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>The <code>TimeWidget</code> is displayed as a stepper
with a text input that allow to input directly
a time. In that case the focus is provided
by the text input.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">@mixins</span> <span class="nx">FocusProvidedByChild</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Setup the concrete function for validation and conversion
of the <code>AbstractDateInputWidget</code> class.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="py">@supportedType</span> <span class="o">=</span> <span class="s">&quot;time&quot;</span>
        <span class="py">@valueToDate</span> <span class="o">=</span> <span class="nx">timeFromString</span>
        <span class="py">@dateToValue</span> <span class="o">=</span> <span class="nx">timeToString</span>
        <span class="py">@isValidValue</span> <span class="o">=</span> <span class="nx">isValidTime</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>The default <code>step</code> for a time input is one minute.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">super</span> <span class="nx">target</span><span class="p">,</span> <span class="mi">60</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <h3>Dummy management</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>The dummy of a <code>TimeInput</code> is the same as the <code>Stepper</code>'s' one,
one text input, and two additional buttons to increment or
decrement the value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">createDummy</span><span class="o">:-&gt;</span>
        <span class="nv">dummy </span><span class="o">=</span> <span class="k">super</span><span class="p">()</span>
        <span class="nx">dummy</span><span class="p">.</span><span class="nx">append</span> <span class="nx">$</span> <span class="s">&quot;&quot;&quot;&lt;input type=&#39;text&#39; class=&#39;value widget-done&#39;&gt;&lt;/input&gt;</span>
<span class="s">                        &lt;span class=&#39;down&#39;&gt;&lt;/span&gt;</span>
<span class="s">                        &lt;span class=&#39;up&#39;&gt;&lt;/span&gt;&quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>The focus isValidValue provided by the text input.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="py">@focusProvider</span> <span class="o">=</span> <span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span> <span class="s">&quot;input&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Gets references to the buttons for setup.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">down </span><span class="o">=</span> <span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.down&quot;</span><span class="p">)</span>
        <span class="nv">up </span><span class="o">=</span> <span class="nx">dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;.up&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Pressing on the buttons starts an increment or decrement
interval according to the pressed button.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nv">buttonsMousedown </span><span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">=&gt;</span>
            <span class="nx">e</span><span class="p">.</span><span class="nx">stopImmediatePropagation</span><span class="p">()</span>

            <span class="py">@mousePressed</span> <span class="o">=</span> <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>The function that start and end the interval
are stored locally according to the pressed button.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span>
                <span class="k">when</span> <span class="nx">down</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="nv">startFunction </span><span class="o">=</span> <span class="py">@startDecrement</span>
                    <span class="nv">endFunction   </span><span class="o">=</span> <span class="py">@endDecrement</span>
                <span class="k">when</span> <span class="nx">up</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="nv">startFunction </span><span class="o">=</span> <span class="py">@startIncrement</span>
                    <span class="nv">endFunction   </span><span class="o">=</span> <span class="py">@endIncrement</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Initiate the interval.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">startFunction</span><span class="p">.</span><span class="nx">call</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>And register a callback to stop the interval on <code>mouseup</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="py">@documentDelegate</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">=&gt;</span>
                <span class="py">@mousePressed</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="nx">endFunction</span><span class="p">.</span><span class="nx">call</span> <span class="k">this</span>
                <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span> <span class="py">@documentDelegate</span>

        <span class="nx">down</span><span class="p">.</span><span class="nx">bind</span> <span class="s">&quot;mousedown&quot;</span><span class="p">,</span> <span class="nx">buttonsMousedown</span>
        <span class="nx">up</span><span class="p">.</span><span class="nx">bind</span> <span class="s">&quot;mousedown&quot;</span><span class="p">,</span> <span class="nx">buttonsMousedown</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>When the mouse go out of the button while
an interval is runnung, the interval is stopped.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">down</span><span class="p">.</span><span class="nx">bind</span> <span class="s">&quot;mouseout&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="py">@incrementInterval</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="py">@endDecrement</span><span class="p">()</span>
        <span class="nx">up</span><span class="p">.</span><span class="nx">bind</span> <span class="s">&quot;mouseout&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="py">@incrementInterval</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span> <span class="k">then</span> <span class="py">@endIncrement</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Until the mouse came back over the button.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">down</span><span class="p">.</span><span class="nx">bind</span> <span class="s">&quot;mouseover&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="py">@mousePressed</span> <span class="k">then</span> <span class="py">@startDecrement</span><span class="p">()</span>
        <span class="nx">up</span><span class="p">.</span><span class="nx">bind</span> <span class="s">&quot;mouseover&quot;</span><span class="p">,</span> <span class="o">=&gt;</span>
            <span class="k">if</span> <span class="py">@mousePressed</span> <span class="k">then</span> <span class="py">@startIncrement</span><span class="p">()</span>

        <span class="nx">dummy</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>The displayed value for a <code>TimeInput</code> is the time in the
format <code>hh:mm</code>, neither the seconds nor the milliseconds
are displayed.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">updateDummy</span><span class="o">:-&gt;</span>
        <span class="py">@dummy</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">).</span><span class="nx">val</span> <span class="py">@get</span><span class="p">(</span><span class="s">&quot;value&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">..</span><span class="mi">1</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>The states of the widget is reflected on the widget's input.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">updateStates</span><span class="o">:-&gt;</span>
        <span class="k">super</span><span class="p">()</span>

        <span class="k">if</span> <span class="py">@get</span> <span class="s">&quot;readonly&quot;</span> <span class="k">then</span> <span class="py">@focusProvider</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;readonly&quot;</span><span class="p">,</span> <span class="s">&quot;readonly&quot;</span>
        <span class="k">else</span> <span class="py">@focusProvider</span><span class="p">.</span><span class="nx">removeAttr</span> <span class="s">&quot;readonly&quot;</span>

        <span class="k">if</span> <span class="py">@get</span> <span class="s">&quot;disabled&quot;</span> <span class="k">then</span> <span class="py">@focusProvider</span><span class="p">.</span><span class="nx">attr</span> <span class="s">&quot;disabled&quot;</span><span class="p">,</span> <span class="s">&quot;disabled&quot;</span>
        <span class="k">else</span> <span class="py">@focusProvider</span><span class="p">.</span><span class="nx">removeAttr</span> <span class="s">&quot;disabled&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <h3>Events handlers</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Catch changes made to the text input content, validates it, and
affect it as the new value if validated.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">change</span><span class="o">:</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">-&gt;</span>
        <span class="nv">value </span><span class="o">=</span> <span class="py">@focusProvider</span><span class="p">.</span><span class="nx">val</span><span class="p">()</span>
        <span class="k">if</span> <span class="py">@isValidValue</span> <span class="nx">value</span> <span class="k">then</span> <span class="py">@set</span> <span class="s">&quot;value&quot;</span><span class="p">,</span> <span class="nx">value</span> <span class="k">else</span> <span class="py">@updateDummy</span><span class="p">()</span>


    <span class="py">input</span><span class="o">:</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Releasing the mouse over the widget will force the focus on the
input. That way, clicking on the increment and decrement button
will also give the focus to the widget.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">mouseup</span><span class="o">:-&gt;</span>
        <span class="k">if</span> <span class="py">@get</span> <span class="s">&quot;disabled&quot;</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">true</span>

        <span class="py">@grabFocus</span><span class="p">()</span>

        <span class="k">if</span> <span class="py">@dragging</span>
            <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span> <span class="py">@documentMouseMoveDelegate</span>
            <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">unbind</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span>   <span class="py">@documentMouseUpDelegate</span>
            <span class="py">@dragging</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="kc">true</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>The <code>TimeInput</code> allow to drag the mouse vertically to change the value.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">mousedown</span><span class="o">:</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">if</span> <span class="py">@cantInteract</span><span class="p">()</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">true</span>

        <span class="py">@dragging</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="py">@pressedY</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span>

        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mousemove&quot;</span><span class="p">,</span>
                         <span class="py">@documentMouseMoveDelegate</span> <span class="o">=</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span><span class="o">=&gt;</span> <span class="py">@mousemove</span> <span class="nx">e</span>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">bind</span> <span class="s">&quot;mouseup&quot;</span><span class="p">,</span>
                         <span class="py">@documentMouseUpDelegate</span>   <span class="o">=</span><span class="p">(</span> <span class="nx">e</span> <span class="p">)</span><span class="o">=&gt;</span> <span class="py">@mouseup</span> <span class="nx">e</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>The value is changed on the basis that a move of 1 pixel change the value
of the amount of <code>step</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="py">mousemove</span><span class="o">:</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">-&gt;</span>
        <span class="k">if</span> <span class="py">@dragging</span>
            <span class="nv">y </span><span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span>
            <span class="nv">dif </span><span class="o">=</span> <span class="py">@pressedY</span> <span class="o">-</span> <span class="nx">y</span>
            <span class="nv">ms </span><span class="o">=</span> <span class="py">@get</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">).</span><span class="nx">valueOf</span><span class="p">()</span>
            <span class="nv">step </span><span class="o">=</span> <span class="py">@get</span> <span class="s">&quot;step&quot;</span>

            <span class="py">@set</span> <span class="s">&quot;date&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span> <span class="nx">ms</span> <span class="o">+</span> <span class="nx">dif</span> <span class="o">*</span> <span class="nx">step</span> <span class="o">*</span> <span class="nx">MILLISECONDS_IN_SECOND</span>
            <span class="py">@pressedY</span> <span class="o">=</span> <span class="nx">y</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p><a name='date'></a></p>

<h1>Date</h1>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>A valid date is a string such as <code>2012-12-29</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidDate</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="p">(</span><span class="sr">///</span> <span class="sro">^</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">4</span><span class="sro">}</span><span class="sr">-   </span><span class="c1"># Year</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span><span class="sr">-   </span><span class="c1"># Month</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>    <span class="c1"># Day of the month</span>
    <span class="sro">$</span> <span class="sr">///</span><span class="p">).</span><span class="nx">test</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>A valid date string can be passed directly to the <code>Date</code> constructor.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">dateFromString</span><span class="o">=</span><span class="p">(</span> <span class="nx">string</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">d </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="nx">string</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Hours may vary when constructing a <code>Date</code> from a date string.
The returned date's hours are then reset to <code>0</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">d</span><span class="p">.</span><span class="nx">setHours</span> <span class="mi">0</span>
    <span class="nx">d</span>

<span class="nv">dateToString</span><span class="o">=</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="p">[</span> <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(),</span> <span class="mi">4</span> <span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
      <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>   <span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
      <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span>        <span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
    <span class="p">].</span><span class="nx">join</span> <span class="s">&quot;-&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p><a name='DateInput'></a></p>

<h3>DateInput</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">DateInput</span> <span class="k">extends</span> <span class="nx">AbstractDateInputWidget</span>
    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="py">@supportedType</span> <span class="o">=</span> <span class="s">&quot;date&quot;</span>
        <span class="py">@valueToDate</span> <span class="o">=</span> <span class="nx">dateFromString</span>
        <span class="py">@dateToValue</span> <span class="o">=</span> <span class="nx">dateToString</span>
        <span class="py">@isValidValue</span> <span class="o">=</span> <span class="nx">isValidDate</span>

        <span class="k">super</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p><a name='month'></a></p>

<h1>Month</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidMonth</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="p">(</span><span class="sr">///</span> <span class="sro">^</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">4</span><span class="sro">}</span><span class="sr">-   </span><span class="c1"># Year</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>    <span class="c1"># Month</span>
    <span class="sro">$</span> <span class="sr">///</span><span class="p">).</span><span class="nx">test</span> <span class="nx">value</span>

<span class="nv">monthFromString</span><span class="o">=</span><span class="p">(</span> <span class="nx">string</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">d </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="nx">string</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Hours may vary when constructing a <code>Date</code>.
The returned date's hours are then reset to <code>0</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">d</span><span class="p">.</span><span class="nx">setHours</span> <span class="mi">0</span>
    <span class="nx">d</span>

<span class="nv">monthToString</span><span class="o">=</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(),</span> <span class="mi">4</span> <span class="si">}</span><span class="s">-</span><span class="si">#{</span> <span class="nx">fill</span> <span class="p">(</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span> <span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p><a name='MonthInput'></a></p>

<h3>MonthInput</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">MonthInput</span> <span class="k">extends</span> <span class="nx">AbstractDateInputWidget</span>
    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="py">@supportedType</span> <span class="o">=</span> <span class="s">&quot;month&quot;</span>
        <span class="py">@valueToDate</span> <span class="o">=</span> <span class="nx">monthFromString</span>
        <span class="py">@dateToValue</span> <span class="o">=</span> <span class="nx">monthToString</span>
        <span class="py">@isValidValue</span> <span class="o">=</span> <span class="nx">isValidMonth</span>

        <span class="k">super</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p><a name='week'></a></p>

<h1>Week</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidWeek</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="p">(</span><span class="sr">///</span> <span class="sro">^</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">4</span><span class="sro">}</span>    <span class="c1"># Year</span>
        <span class="sr">-W         </span><span class="c1"># Week separator</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>    <span class="c1"># Week number prefixed with W</span>
    <span class="sro">$</span> <span class="sr">///</span><span class="p">).</span><span class="nx">test</span> <span class="nx">value</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Converts a string such as <code>2011-W09</code> into a <code>Date</code> object
that represent the first day of the corresponding week, even
if it's not in the same year.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">weekFromString</span><span class="o">=</span><span class="p">(</span> <span class="nx">string</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="p">[</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">week</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">parseInt</span> <span class="nx">s</span> <span class="k">for</span> <span class="nx">s</span> <span class="k">in</span> <span class="nx">string</span><span class="p">.</span><span class="nx">split</span> <span class="s">&quot;-W&quot;</span> <span class="p">)</span>

    <span class="nx">getWeekDate</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">week</span>

<span class="nv">weekToString</span><span class="o">=</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">start </span><span class="o">=</span> <span class="nx">findFirstWeekFirstDay</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">()</span>
    <span class="nv">dif   </span><span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span>
    <span class="nv">week  </span><span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span> <span class="p">(</span> <span class="nx">dif</span> <span class="o">/</span> <span class="nx">MILLISECONDS_IN_WEEK</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(),</span> <span class="mi">4</span> <span class="si">}</span><span class="s">-W</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">week</span> <span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Returns a <code>Date</code> that is the first day of the first week of the year.
In fact, the returned <code>Date</code> can represent a day that is not in <code>year</code>
as a year can start in the middle of a week.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">findFirstWeekFirstDay</span><span class="o">=</span><span class="p">(</span> <span class="nx">year</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">d </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="nx">year</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
    <span class="nv">day </span><span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">getDay</span><span class="p">()</span>

    <span class="k">if</span> <span class="nx">day</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="nv">day </span><span class="o">=</span> <span class="mi">7</span>

    <span class="k">if</span> <span class="nx">day</span> <span class="o">&gt;</span> <span class="mi">3</span>
        <span class="k">new</span> <span class="nb">Date</span> <span class="nx">year</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span> <span class="o">-</span> <span class="nx">day</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">else</span>
        <span class="k">new</span> <span class="nb">Date</span> <span class="nx">year</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">-</span> <span class="nx">day</span><span class="p">,</span> <span class="mi">0</span>

<span class="nv">getWeekDate</span><span class="o">=</span><span class="p">(</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">week</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">start </span><span class="o">=</span> <span class="nx">findFirstWeekFirstDay</span> <span class="nx">year</span>
    <span class="nv">date </span><span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span> <span class="nx">start</span><span class="p">.</span><span class="nx">valueOf</span><span class="p">()</span> <span class="o">+</span> <span class="nx">MILLISECONDS_IN_WEEK</span> <span class="o">*</span> <span class="p">(</span> <span class="nx">week</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>
    <span class="nx">date</span><span class="p">.</span><span class="nx">setHours</span> <span class="mi">0</span>
    <span class="nx">date</span><span class="p">.</span><span class="nx">setMinutes</span> <span class="mi">0</span>
    <span class="nx">date</span><span class="p">.</span><span class="nx">setSeconds</span> <span class="mi">0</span>
    <span class="nx">date</span><span class="p">.</span><span class="nx">setMilliseconds</span> <span class="mi">0</span>
    <span class="nx">date</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p><a name='WeekInput'></a></p>

<h3>WeekInput</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">WeekInput</span> <span class="k">extends</span> <span class="nx">AbstractDateInputWidget</span>
    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="py">@supportedType</span> <span class="o">=</span> <span class="s">&quot;week&quot;</span>
        <span class="py">@valueToDate</span> <span class="o">=</span> <span class="nx">weekFromString</span>
        <span class="py">@dateToValue</span> <span class="o">=</span> <span class="nx">weekToString</span>
        <span class="py">@isValidValue</span> <span class="o">=</span> <span class="nx">isValidWeek</span>

        <span class="k">super</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p><a name='datetime'></a></p>

<h1>DateTime</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">isValidDateTime</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="p">(</span><span class="sr">///</span> <span class="sro">^</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">4</span><span class="sro">}</span><span class="sr">-       </span><span class="c1"># Year</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span><span class="sr">-       </span><span class="c1"># Month</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>        <span class="c1"># Day of the Month</span>
        <span class="sr">T              </span><span class="c1"># Start time token</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span><span class="sr">:       </span><span class="c1"># Hours</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span><span class="sr">:       </span><span class="c1"># Minutes</span>
        <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>        <span class="c1"># Seconds</span>
        <span class="sro">(</span><span class="sr">\.</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">1,4</span><span class="sro">})?</span> <span class="c1"># Optionnal milliseconds</span>
        <span class="sro">(</span>              <span class="c1"># Mandatory terminator</span>
            <span class="sr">Z|         </span><span class="c1"># Either Z,</span>
            <span class="sro">(</span><span class="sr">\</span><span class="sro">+</span><span class="sr">|\-</span><span class="sro">)+</span>   <span class="c1"># +XX:XX or -XX:XX</span>
            <span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span><span class="sr">:</span>
<span class="sr">            </span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">}</span>
        <span class="sro">)</span>
    <span class="sro">$</span> <span class="sr">///</span><span class="p">).</span><span class="nx">test</span> <span class="nx">value</span>

<span class="nv">datetimeFromString</span><span class="o">=</span><span class="p">(</span> <span class="nx">string</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">new</span> <span class="nb">Date</span> <span class="nx">string</span>

<span class="nv">datetimeToString</span><span class="o">=</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="nv">offset </span><span class="o">=</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getTimezoneOffset</span><span class="p">()</span>
    <span class="nv">sign </span><span class="o">=</span> <span class="s">&quot;-&quot;</span>
    <span class="k">if</span> <span class="nx">offset</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="nv">sign </span><span class="o">=</span> <span class="s">&quot;+&quot;</span>
        <span class="nx">offset</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="nv">minutes </span><span class="o">=</span> <span class="nx">offset</span> <span class="o">%</span> <span class="mi">60</span>
    <span class="nv">hours </span><span class="o">=</span> <span class="p">(</span> <span class="nx">offset</span> <span class="o">-</span> <span class="nx">minutes</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="p">[</span> <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">dateToString</span> <span class="nx">date</span> <span class="si">}</span><span class="s">T&quot;</span><span class="p">,</span>
      <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">timeToString</span> <span class="nx">date</span> <span class="si">}</span><span class="s">&quot;</span><span class="p">,</span>
      <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">sign</span> <span class="si">}#{</span> <span class="nx">fill</span> <span class="nx">hours</span> <span class="si">}</span><span class="s">:</span><span class="si">#{</span> <span class="nx">fill</span> <span class="nx">minutes</span> <span class="si">}</span><span class="s">&quot;</span>
    <span class="p">].</span><span class="nx">join</span> <span class="s">&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p><a name='DateTimeInput'></a></p>

<h3>DateTimeInput</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">DateTimeInput</span> <span class="k">extends</span> <span class="nx">AbstractDateInputWidget</span>
    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="py">@supportedType</span> <span class="o">=</span> <span class="s">&quot;datetime&quot;</span>
        <span class="py">@valueToDate</span> <span class="o">=</span> <span class="nx">datetimeFromString</span>
        <span class="py">@dateToValue</span> <span class="o">=</span> <span class="nx">datetimeToString</span>
        <span class="py">@isValidValue</span> <span class="o">=</span> <span class="nx">isValidDateTime</span>

        <span class="k">super</span> <span class="nx">target</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p><a name='datetime-local'></a></p>

<h1>DateTimeLocal</h1>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">validationRegexp</span><span class="o">=</span> <span class="o">-&gt;</span>
    <span class="sr">///</span> <span class="sro">^</span>
        <span class="sro">(</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">4</span><span class="sro">})</span><span class="sr">-     </span><span class="c1"># Year</span>
        <span class="sro">(</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">})</span><span class="sr">-     </span><span class="c1"># Month</span>
        <span class="sro">(</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">})</span>      <span class="c1"># Day of the Month</span>
        <span class="sr">T              </span><span class="c1"># Start time token</span>
        <span class="sro">(</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">})</span><span class="sr">:     </span><span class="c1"># Hours</span>
        <span class="sro">(</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">})</span><span class="sr">:     </span><span class="c1"># Minutes</span>
        <span class="sro">(</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">2</span><span class="sro">})</span>      <span class="c1"># Seconds</span>
        <span class="sro">(</span><span class="sr">\.</span><span class="src">[</span><span class="sre">\d</span><span class="src">]</span><span class="sro">{</span><span class="sri">1,3</span><span class="sro">})?</span> <span class="c1"># Optionnal milliseconds</span>
    <span class="sro">$</span> <span class="sr">///</span>

<span class="nv">isValidDateTimeLocal</span><span class="o">=</span><span class="p">(</span> <span class="nx">value</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="k">unless</span> <span class="nx">value</span><span class="o">?</span> <span class="k">then</span> <span class="k">return</span> <span class="kc">false</span>
    <span class="nx">validationRegexp</span><span class="p">().</span><span class="nx">test</span> <span class="nx">value</span>

<span class="nv">datetimeLocalFromString</span><span class="o">=</span><span class="p">(</span> <span class="nx">string</span> <span class="p">)</span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Passing the date string directly in the constructor is valid,
however the behavior in chrome and firefox are quite different,
chrome consider that the passed-in date has an offset of <code>0</code>
and the convert it to the current local offset when firefox
consider the datestring as in the current local offset.
In consequences, The date will differ between the two browsers
of the amount of the current local offset.</p>

<p>The <code>Date</code> will be created by parsing the string with the validation
regex and pass each value as an argument in the <code>Date</code> constructor.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">[</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">year</span><span class="p">,</span> <span class="nx">month</span><span class="p">,</span>
      <span class="nx">day</span><span class="p">,</span> <span class="nx">hours</span><span class="p">,</span> <span class="nx">minutes</span><span class="p">,</span>
      <span class="nx">seconds</span><span class="p">,</span> <span class="nx">milliseconds</span> <span class="p">]</span> <span class="o">=</span> <span class="nx">validationRegexp</span><span class="p">().</span><span class="nx">exec</span> <span class="nx">string</span>

    <span class="nv">pI </span><span class="o">=</span> <span class="nb">parseInt</span>
    <span class="k">new</span> <span class="nb">Date</span> <span class="nx">pI</span><span class="p">(</span> <span class="nx">year</span>    <span class="p">,</span> <span class="mi">10</span> <span class="p">),</span>
             <span class="nx">pI</span><span class="p">(</span> <span class="nx">month</span>   <span class="p">,</span> <span class="mi">10</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
             <span class="nx">pI</span><span class="p">(</span> <span class="nx">day</span>     <span class="p">,</span> <span class="mi">10</span> <span class="p">),</span>
             <span class="nx">pI</span><span class="p">(</span> <span class="nx">hours</span>   <span class="p">,</span> <span class="mi">10</span> <span class="p">),</span>
             <span class="nx">pI</span><span class="p">(</span> <span class="nx">minutes</span> <span class="p">,</span> <span class="mi">10</span> <span class="p">),</span>
             <span class="nx">pI</span><span class="p">(</span> <span class="nx">seconds</span> <span class="p">,</span> <span class="mi">10</span> <span class="p">)</span>
             <span class="k">if</span> <span class="nx">milliseconds</span><span class="o">?</span> <span class="k">then</span> <span class="nx">pI</span> <span class="nx">milliseconds</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">),</span> <span class="mi">10</span> <span class="k">else</span> <span class="mi">0</span>

<span class="nv">datetimeLocalToString</span><span class="o">=</span><span class="p">(</span> <span class="nx">date</span> <span class="p">)</span><span class="o">-&gt;</span>
    <span class="s">&quot;</span><span class="si">#{</span> <span class="nx">dateToString</span> <span class="nx">date</span> <span class="si">}</span><span class="s">T</span><span class="si">#{</span> <span class="nx">timeToString</span> <span class="nx">date</span> <span class="si">}</span><span class="s">&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p><a name='DateTimeLocalInput'></a>
FIX Find a way to fix the opera issue</p>

<h3>DateTimeLocalInput</h3>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">DateTimeLocalInput</span> <span class="k">extends</span> <span class="nx">AbstractDateInputWidget</span>
    <span class="py">constructor</span><span class="o">:</span><span class="p">(</span> <span class="nx">target</span> <span class="p">)</span><span class="o">-&gt;</span>
        <span class="py">@supportedType</span> <span class="o">=</span> <span class="s">&quot;datetime-local&quot;</span>
        <span class="py">@valueToDate</span> <span class="o">=</span> <span class="nx">datetimeLocalFromString</span>
        <span class="py">@dateToValue</span> <span class="o">=</span> <span class="nx">datetimeLocalToString</span>
        <span class="py">@isValidValue</span> <span class="o">=</span> <span class="nx">isValidDateTimeLocal</span>

        <span class="k">super</span> <span class="nx">target</span>

<span class="py">@isValidTime</span> <span class="o">=</span> <span class="nx">isValidTime</span>
<span class="py">@timeToString</span> <span class="o">=</span> <span class="nx">timeToString</span>
<span class="py">@timeFromString</span> <span class="o">=</span> <span class="nx">timeFromString</span>

<span class="py">@isValidDate</span> <span class="o">=</span> <span class="nx">isValidDate</span>
<span class="py">@dateToString</span> <span class="o">=</span> <span class="nx">dateToString</span>
<span class="py">@dateFromString</span> <span class="o">=</span> <span class="nx">dateFromString</span>

<span class="py">@isValidMonth</span> <span class="o">=</span> <span class="nx">isValidMonth</span>
<span class="py">@monthToString</span> <span class="o">=</span> <span class="nx">monthToString</span>
<span class="py">@monthFromString</span> <span class="o">=</span> <span class="nx">monthFromString</span>

<span class="py">@isValidWeek</span> <span class="o">=</span> <span class="nx">isValidWeek</span>
<span class="py">@weekToString</span> <span class="o">=</span> <span class="nx">weekToString</span>
<span class="py">@weekFromString</span> <span class="o">=</span> <span class="nx">weekFromString</span>

<span class="py">@isValidDateTime</span> <span class="o">=</span> <span class="nx">isValidDateTime</span>
<span class="py">@datetimeToString</span> <span class="o">=</span> <span class="nx">datetimeToString</span>
<span class="py">@datetimeFromString</span> <span class="o">=</span> <span class="nx">datetimeFromString</span>

<span class="py">@isValidDateTimeLocal</span> <span class="o">=</span> <span class="nx">isValidDateTimeLocal</span>
<span class="py">@datetimeLocalToString</span> <span class="o">=</span> <span class="nx">datetimeLocalToString</span>
<span class="py">@datetimeLocalFromString</span> <span class="o">=</span> <span class="nx">datetimeLocalFromString</span>

<span class="py">@TimeInput</span> <span class="o">=</span> <span class="nx">TimeInput</span>
<span class="py">@DateInput</span> <span class="o">=</span> <span class="nx">DateInput</span>
<span class="py">@MonthInput</span> <span class="o">=</span> <span class="nx">MonthInput</span>
<span class="py">@WeekInput</span> <span class="o">=</span> <span class="nx">WeekInput</span>
<span class="py">@DateTimeInput</span> <span class="o">=</span> <span class="nx">DateTimeInput</span>
<span class="py">@DateTimeLocalInput</span> <span class="o">=</span> <span class="nx">DateTimeLocalInput</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 